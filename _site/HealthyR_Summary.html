<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>healthyr_summary – HDS MSc - Module 3 - PreProcessing/EDA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./EDA_Practical3.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6e1ef360f16fe2768cc3d2c841dec8bb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">HDS MSc - Module 3 - PreProcessing/EDA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link active" href="./HistogramBoxplot.html" aria-current="page"> 
<span class="menu-text">EDA and Pre-Processing</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./HealthyR_Summary.html">Data wrangling with R</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./HistogramBoxplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Histograms and Boxplots</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./AssessRelationships.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualize higher dimensional associations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Correlation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Correlation - R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MissingPackages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Missing Pipelines in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Imputation_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Imputation in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EDA_Practical1_Final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Missing Data Imputation - Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EDA_Practical2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Outlier Detection - Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EDA_Practical3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Transformation - Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./HealthyR_Summary.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Data wrangling with R</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#data-wrangling-with-r" id="toc-data-wrangling-with-r" class="nav-link active" data-scroll-target="#data-wrangling-with-r">Data wrangling with R</a></li>
  <li><a href="#tidyverse-packages-ggplot2-dplyr-tidyr-etc." id="toc-tidyverse-packages-ggplot2-dplyr-tidyr-etc." class="nav-link" data-scroll-target="#tidyverse-packages-ggplot2-dplyr-tidyr-etc.">Tidyverse packages: ggplot2, dplyr, tidyr, etc.</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#plot-the-data" id="toc-plot-the-data" class="nav-link" data-scroll-target="#plot-the-data">Plot the data</a></li>
  <li><a href="#aggregating-group_by-summarise" id="toc-aggregating-group_by-summarise" class="nav-link" data-scroll-target="#aggregating-group_by-summarise">Aggregating: <code>group_by()</code>, <code>summarise()</code></a></li>
  <li>
<a href="#add-new-columns-mutate" id="toc-add-new-columns-mutate" class="nav-link" data-scroll-target="#add-new-columns-mutate">Add new columns: <code>mutate()</code></a>
  <ul class="collapse">
<li><a href="#percentages-formatting-percent" id="toc-percentages-formatting-percent" class="nav-link" data-scroll-target="#percentages-formatting-percent">Percentages formatting: <code>percent()</code></a></li>
  </ul>
</li>
  <li><a href="#summarise-vs-mutate" id="toc-summarise-vs-mutate" class="nav-link" data-scroll-target="#summarise-vs-mutate"><code>summarise()</code> vs <code>mutate()</code></a></li>
  <li><a href="#common-arithmetic-functions---sum-mean-median-etc." id="toc-common-arithmetic-functions---sum-mean-median-etc." class="nav-link" data-scroll-target="#common-arithmetic-functions---sum-mean-median-etc.">Common arithmetic functions - <code>sum()</code>, <code>mean()</code>, <code>median()</code>, etc.</a></li>
  <li><a href="#select-columns" id="toc-select-columns" class="nav-link" data-scroll-target="#select-columns"><code>select()</code> columns</a></li>
  <li>
<a href="#reshaping-data---long-vs-wide-format" id="toc-reshaping-data---long-vs-wide-format" class="nav-link" data-scroll-target="#reshaping-data---long-vs-wide-format">Reshaping data - long vs wide format</a>
  <ul class="collapse">
<li><a href="#pivot-values-from-rows-into-columns-wider" id="toc-pivot-values-from-rows-into-columns-wider" class="nav-link" data-scroll-target="#pivot-values-from-rows-into-columns-wider">Pivot values from rows into columns (wider)</a></li>
  <li><a href="#pivot-values-from-columns-to-rows-longer" id="toc-pivot-values-from-columns-to-rows-longer" class="nav-link" data-scroll-target="#pivot-values-from-columns-to-rows-longer">Pivot values from columns to rows (longer)</a></li>
  <li><a href="#separate-a-column-into-multiple-columns" id="toc-separate-a-column-into-multiple-columns" class="nav-link" data-scroll-target="#separate-a-column-into-multiple-columns"><code>separate()</code> a column into multiple columns</a></li>
  </ul>
</li>
  <li>
<a href="#arrange-rows" id="toc-arrange-rows" class="nav-link" data-scroll-target="#arrange-rows"><code>arrange()</code> rows</a>
  <ul class="collapse">
<li><a href="#factor-levels" id="toc-factor-levels" class="nav-link" data-scroll-target="#factor-levels">Factor levels</a></li>
  </ul>
</li>
  <li>
<a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul class="collapse">
<li><a href="#exercise---pivot_wider" id="toc-exercise---pivot_wider" class="nav-link" data-scroll-target="#exercise---pivot_wider">Exercise - <code>pivot_wider()</code></a></li>
  <li><a href="#exercise---group_by-summarise" id="toc-exercise---group_by-summarise" class="nav-link" data-scroll-target="#exercise---group_by-summarise">Exercise - <code>group_by()</code>, <code>summarise()</code></a></li>
  <li><a href="#exercise---full_join-percent" id="toc-exercise---full_join-percent" class="nav-link" data-scroll-target="#exercise---full_join-percent">Exercise - <code>full_join()</code>, <code>percent()</code></a></li>
  <li><a href="#exercise---mutate-summarise" id="toc-exercise---mutate-summarise" class="nav-link" data-scroll-target="#exercise---mutate-summarise">Exercise - <code>mutate()</code>, <code>summarise()</code></a></li>
  <li><a href="#exercise---filter-summarise-pivot_wider" id="toc-exercise---filter-summarise-pivot_wider" class="nav-link" data-scroll-target="#exercise---filter-summarise-pivot_wider">Exercise - <code>filter()</code>, <code>summarise()</code>, <code>pivot_wider()</code></a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"><h1 class="title display-7"></h1></header><div class="quarto-title-block"><div class="quarto-title-tools-only"><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div><section id="data-wrangling-with-r" class="level3"><h3 class="anchored" data-anchor-id="data-wrangling-with-r">Data wrangling with R</h3>
<p>This code is based on the original work from <a href="https://healthyr.surgicalinformatics.org">HealthyR</a> and has been adapted by <strong>Laura Bravo</strong></p>
</section><section id="tidyverse-packages-ggplot2-dplyr-tidyr-etc." class="level3"><h3 class="anchored" data-anchor-id="tidyverse-packages-ggplot2-dplyr-tidyr-etc.">Tidyverse packages: ggplot2, dplyr, tidyr, etc.</h3>
<p>Most of the functions introduced in this session come from the <a href="http://tidyverse.org/">tidyverse family</a>, rather than Base R. Including <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code> in your script loads a list of packages: ggplot2, dplyr, tidyr, forcats, etc.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.3     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<p>In this session we will get to know key functions to work with data:</p>
<ul>
<li>summarise data using: <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>, and <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>;</li>
<li>reshape data between the wide and long formats: <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>;</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> columns and <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> (sort) rows.</li>
</ul></section><section id="data" class="level2"><h2 class="anchored" data-anchor-id="data">Data</h2>
<p>We are using a condensed version of the <a href="https://ghdx.healthdata.org">Global Burden of Disease Data</a> dataset.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Can load the dataset through many ways but quickest and one i always resort to, is data.table function</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'data.table'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:lubridate':

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    between, first, last</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    transpose</code></pre>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">"global_burden_disease_cause-year-sex-income.csv"</span><span class="op">)</span> <span class="co">#add your working directory</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gbd_full</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   cause year    sex       income deaths_millions
1: Communicable diseases 1990 Female         High            0.21
2: Communicable diseases 1990 Female Upper-Middle            1.15
3: Communicable diseases 1990 Female Lower-Middle            4.43
4: Communicable diseases 1990 Female          Low            1.51
5: Communicable diseases 1990   Male         High            0.26
6: Communicable diseases 1990   Male Upper-Middle            1.35</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Creating a single-year tibble for printing and simple examples:</span></span>
<span><span class="va">gbd2017</span> <span class="op">&lt;-</span> <span class="va">gbd_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2017"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="plot-the-data" class="level2"><h2 class="anchored" data-anchor-id="plot-the-data">Plot the data</h2>
<p>The best way to investigate a dataset is to plot it (do not worry if do not understand the code, will do a separate exercise on plotting later)</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd2017</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># without the mutate(... = fct_relevel()) </span></span>
<span>  <span class="co"># the panels get ordered alphabetically</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>income <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">income</span>,</span>
<span>                              <span class="st">"Low"</span>,</span>
<span>                              <span class="st">"Lower-Middle"</span>,</span>
<span>                              <span class="st">"Upper-Middle"</span>,</span>
<span>                              <span class="st">"High"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># defining the variables using ggplot(aes(...)):</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex</span>, y <span class="op">=</span> <span class="va">deaths_millions</span>, fill <span class="op">=</span> <span class="va">cause</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># type of geom to be used: column (that's a type of barplot):</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># facets for the income groups:</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">income</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># move the legend to the top of the plot (default is "right"):</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="HealthyR_Summary_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="aggregating-group_by-summarise" class="level2"><h2 class="anchored" data-anchor-id="aggregating-group_by-summarise">Aggregating: <code>group_by()</code>, <code>summarise()</code>
</h2>
<p>Health data analysis is frequently concerned with making comparisons between groups. Groups of genes, or diseases, or patients, or populations, etc. An easy approach to the comparison of data by a categorical grouping is therefore essential.</p>
<p>We will introduce flexible functions from <strong>tidyverse</strong> that you can apply in any setting.</p>
<p>To quickly calculate the total number of deaths in 2017, we can select the column and send it into the <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> function:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd2017</span><span class="op">$</span><span class="va">deaths_millions</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 55.74</code></pre>
</div>
</div>
<p>But a much cleverer way of summarising data is using the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> function:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd2017</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_millions</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  sum(deaths_millions)
1                55.74</code></pre>
</div>
</div>
<p><code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> is a function that adds numbers together, whereas <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> is an efficient way of creating summarised dataframes. The main strength of <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> is how it works with the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function. <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> are a perfect complement for each other and used togetehr most of the time.</p>
<p>We use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> to tell <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> which subgroups to apply the calculations on. In the above example, without <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, summarise just works on the whole dataset, yielding the same result as just sending a single column into the <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> function.</p>
<p>We can subset on the cause variable using <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd2017</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cause</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_millions</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  cause                     `sum(deaths_millions)`
  &lt;chr&gt;                                      &lt;dbl&gt;
1 Communicable diseases                      10.4 
2 Injuries                                    4.47
3 Non-communicable diseases                  40.9 </code></pre>
</div>
</div>
<p>Furthermore, <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> is happy to accept multiple grouping variables. So by just copying and editing the above code, we can quickly get summarised totals across multiple grouping variables (by just adding <code>sex</code> inside the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> after <code>cause</code>):</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd2017</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cause</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_millions</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'cause'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
# Groups:   cause [3]
  cause                     sex    `sum(deaths_millions)`
  &lt;chr&gt;                     &lt;chr&gt;                   &lt;dbl&gt;
1 Communicable diseases     Female                   4.91
2 Communicable diseases     Male                     5.47
3 Injuries                  Female                   1.42
4 Injuries                  Male                     3.05
5 Non-communicable diseases Female                  19.2 
6 Non-communicable diseases Male                    21.7 </code></pre>
</div>
</div>
</section><section id="add-new-columns-mutate" class="level2"><h2 class="anchored" data-anchor-id="add-new-columns-mutate">Add new columns: <code>mutate()</code>
</h2>
<p>Let’s first give the summarised column a better name, e.g., <code>deaths_per_group</code>. We can remove groupings by using <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code>. This is important to remember if you want to manipulate the dataset in its original format. We can combine <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> with <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to add a total deaths column, which will be used below to calculate a percentage:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd2017</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cause</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>deaths_per_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_millions</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>deaths_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_per_group</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'cause'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  cause                     sex    deaths_per_group deaths_total
  &lt;chr&gt;                     &lt;chr&gt;             &lt;dbl&gt;        &lt;dbl&gt;
1 Communicable diseases     Female             4.91         55.7
2 Communicable diseases     Male               5.47         55.7
3 Injuries                  Female             1.42         55.7
4 Injuries                  Male               3.05         55.7
5 Non-communicable diseases Female            19.2          55.7
6 Non-communicable diseases Male              21.7          55.7</code></pre>
</div>
</div>
<p>So <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> condenses a dataframe, whereas <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> retains its current size and adds columns.</p>
<section id="percentages-formatting-percent" class="level3"><h3 class="anchored" data-anchor-id="percentages-formatting-percent">Percentages formatting: <code>percent()</code>
</h3>
<p>We can also add further lines to <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to calculate the percentage of each group:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># percent() function for formatting percentages come from library(scales)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span></span>
<span><span class="va">gbd2017_summarised</span> <span class="op">&lt;-</span> <span class="va">gbd2017</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cause</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>deaths_per_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_millions</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>deaths_total    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_per_group</span><span class="op">)</span>,</span>
<span>        deaths_relative <span class="op">=</span> <span class="va">deaths_per_group</span><span class="op">/</span><span class="va">deaths_total</span><span class="op">)</span></span>
<span><span class="va">gbd2017_summarised</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  cause                     sex    deaths_per_group deaths_total deaths_relative
  &lt;chr&gt;                     &lt;chr&gt;             &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;
1 Communicable diseases     Female             4.91         55.7          0.0881
2 Communicable diseases     Male               5.47         55.7          0.0981
3 Injuries                  Female             1.42         55.7          0.0255
4 Injuries                  Male               3.05         55.7          0.0547
5 Non-communicable diseases Female            19.2          55.7          0.344 
6 Non-communicable diseases Male              21.7          55.7          0.390 </code></pre>
</div>
</div>
</section></section><section id="summarise-vs-mutate" class="level2"><h2 class="anchored" data-anchor-id="summarise-vs-mutate">
<code>summarise()</code> vs <code>mutate()</code>
</h2>
<p>So far we’ve shown you examples of using <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> on grouped data (following <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>) and <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> on the whole dataset (without using <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>).</p>
<p>But here’s the thing: <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> is also happy to work on grouped data.</p>
<p>Let’s save the aggregated example from above in a new dataframe. We will then sort the rows using <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> based on <code>sex</code>, just for easier viewing (it was previously sorted by <code>cause</code>).</p>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> function sorts the rows within a tibble:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_summarised</span> <span class="op">&lt;-</span> <span class="va">gbd2017</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cause</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>deaths_per_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_millions</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'cause'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_summarised</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
# Groups:   cause [3]
  cause                     sex    deaths_per_group
  &lt;chr&gt;                     &lt;chr&gt;             &lt;dbl&gt;
1 Communicable diseases     Female             4.91
2 Injuries                  Female             1.42
3 Non-communicable diseases Female            19.2 
4 Communicable diseases     Male               5.47
5 Injuries                  Male               3.05
6 Non-communicable diseases Male              21.7 </code></pre>
</div>
</div>
<p>You should also notice that <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> drops all variables that are not listed in <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> or created inside it. So <code>year</code>, <code>income</code>, and <code>deaths_millions</code> exist in <code>gbd2017</code>, but they do not exist in <code>gbd_summarised</code>.</p>
<p>We now want to calculate the percentage of deaths from each cause for each gender. We could use <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> to calculate the totals:</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_summarised_sex</span> <span class="op">&lt;-</span> <span class="va">gbd_summarised</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>deaths_per_sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_per_group</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gbd_summarised_sex</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  sex    deaths_per_sex
  &lt;chr&gt;           &lt;dbl&gt;
1 Female           25.5
2 Male             30.3</code></pre>
</div>
</div>
<p>But that drops the <code>cause</code> and <code>deaths_per_group</code> columns. One way would be to now use a join on <code>gbd_summarised</code> and <code>gbd_summarised_sex</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">gbd_summarised</span>, <span class="va">gbd_summarised_sex</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(sex)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Groups:   cause [3]
  cause                     sex    deaths_per_group deaths_per_sex
  &lt;chr&gt;                     &lt;chr&gt;             &lt;dbl&gt;          &lt;dbl&gt;
1 Communicable diseases     Female             4.91           25.5
2 Injuries                  Female             1.42           25.5
3 Non-communicable diseases Female            19.2            25.5
4 Communicable diseases     Male               5.47           30.3
5 Injuries                  Male               3.05           30.3
6 Non-communicable diseases Male              21.7            30.3</code></pre>
</div>
</div>
<p>Joining different summaries together can be useful, especially if the individual pipelines are quite long (e.g., over 5 lines of <code>%&gt;%</code>). However, it does increase the chance of mistakes creeping in and is best avoided if possible.</p>
<p>An alternative is to use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> with <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> to achieve the same result as the <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code> above:</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_summarised</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>deaths_per_sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_per_group</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Groups:   sex [2]
  cause                     sex    deaths_per_group deaths_per_sex
  &lt;chr&gt;                     &lt;chr&gt;             &lt;dbl&gt;          &lt;dbl&gt;
1 Communicable diseases     Female             4.91           25.5
2 Injuries                  Female             1.42           25.5
3 Non-communicable diseases Female            19.2            25.5
4 Communicable diseases     Male               5.47           30.3
5 Injuries                  Male               3.05           30.3
6 Non-communicable diseases Male              21.7            30.3</code></pre>
</div>
</div>
<p>So <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> calculates the sums within each grouping variable (in this example just <code>group_by(sex)</code>) and puts the results in a new column without condensing the tibble down or removing any of the existing columns.</p>
<p>Let’s combine all of this together into a single pipeline and calculate the percentages per cause for each gender:</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd2017</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cause</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>deaths_per_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_millions</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>deaths_per_sex  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_per_group</span><span class="op">)</span>,</span>
<span>         sex_cause_perc <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="va">deaths_per_group</span><span class="op">/</span><span class="va">deaths_per_sex</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">deaths_per_group</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'cause'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
# Groups:   sex [2]
  cause                     sex   deaths_per_group deaths_per_sex sex_cause_perc
  &lt;chr&gt;                     &lt;chr&gt;            &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;         
1 Injuries                  Fema…             1.42           25.5 6%            
2 Communicable diseases     Fema…             4.91           25.5 19%           
3 Non-communicable diseases Fema…            19.2            25.5 75%           
4 Injuries                  Male              3.05           30.3 10.1%         
5 Communicable diseases     Male              5.47           30.3 18.1%         
6 Non-communicable diseases Male             21.7            30.3 71.8%         </code></pre>
</div>
</div>
</section><section id="common-arithmetic-functions---sum-mean-median-etc." class="level2"><h2 class="anchored" data-anchor-id="common-arithmetic-functions---sum-mean-median-etc.">Common arithmetic functions - <code>sum()</code>, <code>mean()</code>, <code>median()</code>, etc.</h2>
<p>Statistics is an R strength, so if there is an arithmetic function you can think of, it probably exists in R.</p>
<p>The most common ones are:</p>
<ul>
<li><code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code></li>
<li><code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code></li>
<li><code><a href="https://rdrr.io/r/stats/median.html">median()</a></code></li>
<li>
<code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>
</li>
<li>
<code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code> - standard deviation</li>
<li>
<code><a href="https://rdrr.io/r/stats/IQR.html">IQR()</a></code> - interquartile range</li>
</ul>
<p>An import thing to remember relates to missing data: if any of your values is NA (not available; missing), these functions will return an NA. Either deal with your missing values beforehand (recommended) or add the <code>na.rm = TRUE</code> argument into any of the functions to ask R to ignore missing values.</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mynumbers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">mynumbers</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">mynumbers</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
</section><section id="select-columns" class="level2"><h2 class="anchored" data-anchor-id="select-columns">
<code>select()</code> columns</h2>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> function can be used to choose, rename, or reorder columns of a tibble.</p>
<p>For the following <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> examples, let’s create a new tibble called <code>gbd_2rows</code> by taking the first 2 rows of <code>gbd_full</code> (just for shorter printing):</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_2rows</span> <span class="op">&lt;-</span> <span class="va">gbd_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gbd_2rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   cause year    sex       income deaths_millions
1: Communicable diseases 1990 Female         High            0.21
2: Communicable diseases 1990 Female Upper-Middle            1.15</code></pre>
</div>
</div>
<p>Let’s <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> two of these columns:</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_2rows</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">cause</span>, <span class="va">deaths_millions</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   cause deaths_millions
1: Communicable diseases            0.21
2: Communicable diseases            1.15</code></pre>
</div>
</div>
<p>We can also use <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> to rename the columns we are choosing:</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_2rows</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">cause</span>, deaths <span class="op">=</span> <span class="va">deaths_millions</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   cause deaths
1: Communicable diseases   0.21
2: Communicable diseases   1.15</code></pre>
</div>
</div>
<p>The function <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> is similar to <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, but it keeps all variables whereas <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> only kept the ones we mentioned:</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_2rows</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>deaths <span class="op">=</span> <span class="va">deaths_millions</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   cause year    sex       income deaths
1: Communicable diseases 1990 Female         High   0.21
2: Communicable diseases 1990 Female Upper-Middle   1.15</code></pre>
</div>
</div>
<p><code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> can also be used to reorder the columns in your tibble. Moving columns around is not relevant in data analysis (as any of the functions we showed you above, as well as plotting, only look at the column names, and not their positions in the tibble), but it is useful for organising your tibble for easier viewing.</p>
<p>So if we use select like this:</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_2rows</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">sex</span>, <span class="va">income</span>, <span class="va">cause</span>, <span class="va">deaths_millions</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   year    sex       income                 cause deaths_millions
1: 1990 Female         High Communicable diseases            0.21
2: 1990 Female Upper-Middle Communicable diseases            1.15</code></pre>
</div>
</div>
<p>The columns are reordered.</p>
<p>If you want to move specific column(s) to the front of the tibble, do:</p>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_2rows</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">sex</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   year    sex                 cause       income deaths_millions
1: 1990 Female Communicable diseases         High            0.21
2: 1990 Female Communicable diseases Upper-Middle            1.15</code></pre>
</div>
</div>
<p>And this is where the true power of <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> starts to come out. In addition to listing the columns explicitly (e.g., <code>mydata %&gt;% select(year, cause...)</code>) there are several special functions that can be used inside <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>. These special functions are called select helpers, and the first select helper we used is <code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code>.</p>
<p>The most common select helpers are <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code> (but there are several others that may be useful to you, so press F1 on <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> for a full list, or search the web for more examples).</p>
<p>Let’s say you can’t remember whether the deaths column was called <code>deaths_millions</code> or just <code>deaths</code> or <code>deaths_mil</code>, or maybe there are other columns that include the word “deaths” that you want to <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_2rows</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"deaths"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   deaths_millions
1:            0.21
2:            1.15</code></pre>
</div>
</div>
<p>Note how “deaths” needs to be quoted inside <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code> - as it’s a word to look for, not the real name of a column/variable.</p>
</section><section id="reshaping-data---long-vs-wide-format" class="level2"><h2 class="anchored" data-anchor-id="reshaping-data---long-vs-wide-format">Reshaping data - long vs wide format</h2>
<p>So far, all of the examples we’ve shown you have been using ‘tidy’ data. Data is ‘tidy’ when it follows a couple of rules: <em>each variable is in its own column</em>, and <em>each observation is in its own row</em>. Making data ‘tidy’ often means transforming the table from a “wide” format into a “long” format. Long format is efficient to use in data analysis and visualisation and can also be considered “computer readable”.</p>
<p>But sometimes when presenting data in tables for humans to read, or when collecting data directly into a spreadsheet, it can be convenient to have data in a wide format. Data is ‘wide’ when <em>some or all of the columns are levels of a factor</em>. An example makes this easier to see.</p>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"global_burden_disease_wide-format.csv"</span><span class="op">)</span> <span class="co">#add your wd</span></span>
<span><span class="va">gbd_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"global_burden_disease_cause-year-sex.csv"</span><span class="op">)</span>  <span class="co">##add your wd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gbd_wide</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  cause                     Female_1990 Female_2017 Male_1990 Male_2017
  &lt;chr&gt;                           &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 Communicable diseases            7.3         4.91      8.06      5.47
2 Injuries                         1.41        1.42      2.84      3.05
3 Non-communicable diseases       12.8        19.2      13.9      21.7 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gbd_long</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  cause                  year sex    deaths_millions
  &lt;chr&gt;                 &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
1 Communicable diseases  1990 Female            7.3 
2 Communicable diseases  2017 Female            4.91
3 Communicable diseases  1990 Male              8.06
4 Communicable diseases  2017 Male              5.47
5 Injuries               1990 Female            1.41
6 Injuries               2017 Female            1.42</code></pre>
</div>
</div>
<p>These tables contain the exact same information, but in long (tidy) and wide formats, respectively.</p>
<section id="pivot-values-from-rows-into-columns-wider" class="level3"><h3 class="anchored" data-anchor-id="pivot-values-from-rows-into-columns-wider">Pivot values from rows into columns (wider)</h3>
<p>If we want to take the long data and put some of the numbers next to each other for easier visualisation, then <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> from the <strong>tidyr</strong> package is the function to do it. It means we want to send a variable into columns, and it needs just two arguments: the variable we want to become the new columns, and the variable where the values currently are.</p>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">year</span>, values_from <span class="op">=</span> <span class="va">deaths_millions</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  cause                     sex    `1990` `2017`
  &lt;chr&gt;                     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;
1 Communicable diseases     Female   7.3    4.91
2 Communicable diseases     Male     8.06   5.47
3 Injuries                  Female   1.41   1.42
4 Injuries                  Male     2.84   3.05
5 Non-communicable diseases Female  12.8   19.2 
6 Non-communicable diseases Male    13.9   21.7 </code></pre>
</div>
</div>
<p>This means we can quickly eyeball how the number of deaths has changed from 1990 to 2017 for each cause category and sex. Whereas if we wanted to quickly look at the difference in the number of deaths for females and males, we can change the <code>names_from =</code> argument from <code>= years</code> to <code>= sex</code>. Furthermore, we can also add a <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to calculate the difference:</p>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">sex</span>, values_from <span class="op">=</span> <span class="va">deaths_millions</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">Male</span> <span class="op">-</span> <span class="va">Female</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  cause                      year Female  Male `Male - Female`
  &lt;chr&gt;                     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;
1 Communicable diseases      1990   7.3   8.06           0.760
2 Communicable diseases      2017   4.91  5.47           0.560
3 Injuries                   1990   1.41  2.84           1.43 
4 Injuries                   2017   1.42  3.05           1.63 
5 Non-communicable diseases  1990  12.8  13.9            1.11 
6 Non-communicable diseases  2017  19.2  21.7            2.59 </code></pre>
</div>
</div>
<p>All of these differences are positive which means every year, more men die than women. Which make sense, as more boys are born than girls.</p>
<p>And what if we want to look at both <code>year</code> and <code>sex</code> at the same time? No problem, <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> can deal with multiple variables at the same time, <code>names_from = c(sex, year)</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">year</span><span class="op">)</span>, values_from <span class="op">=</span> <span class="va">deaths_millions</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  cause                     Female_1990 Female_2017 Male_1990 Male_2017
  &lt;chr&gt;                           &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 Communicable diseases            7.3         4.91      8.06      5.47
2 Injuries                         1.41        1.42      2.84      3.05
3 Non-communicable diseases       12.8        19.2      13.9      21.7 </code></pre>
</div>
</div>
<p><code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> has a few optional arguments that may be useful for you. For example, <code>pivot_wider(..., values_fill = 0)</code> can be used to fill empty cases (if you have any) with a value you specified. Or <code>pivot_wider(..., names_sep = ": ")</code> can be used to change the separator that gets put between the values (e.g., you may want “Female: 1990” instead of the default “Female_1990”). Remember that pressing F1 when your cursor is on a function opens it up in the Help tab where these extra options are listed.</p>
</section><section id="pivot-values-from-columns-to-rows-longer" class="level3"><h3 class="anchored" data-anchor-id="pivot-values-from-columns-to-rows-longer">Pivot values from columns to rows (longer)</h3>
<p>The inverse of <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> is <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>. If you’re lucky enough, your data comes from a proper database and is already in the long and tidy format. But if not you’ll need to know how to wrangle the variables currently spread across different columns into the tidy format (where each column is a variable, each row is an observation).</p>
<p><code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> can be a little bit more difficult to use as you need to describe all the columns to be collected using a <code>select_helper</code>. Run `?select_helpers and click on the first result in the Help tab for a reminder.</p>
<p>For example, here we want to collect all the columns that include the words Female or Male, the select helper for it is <code>matches("Female|Male")</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"Female|Male"</span><span class="op">)</span>, </span>
<span>               names_to <span class="op">=</span> <span class="st">"sex_year"</span>, </span>
<span>               values_to <span class="op">=</span> <span class="st">"deaths_millions"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  cause                 sex_year    deaths_millions
  &lt;chr&gt;                 &lt;chr&gt;                 &lt;dbl&gt;
1 Communicable diseases Female_1990            7.3 
2 Communicable diseases Female_2017            4.91
3 Communicable diseases Male_1990              8.06
4 Communicable diseases Male_2017              5.47
5 Injuries              Female_1990            1.41
6 Injuries              Female_2017            1.42</code></pre>
</div>
</div>
<p>You’re probably looking at the example above and thinking that’s all nice and simple on this miniature example dataset, but how on earth will I figure this out on a real-world example. And you’re right, we won’t deny that <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> is one of the most technically complicated functions in this book, and it can take a lot of trial and error to get it to work. How to get started with your own <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> transformation is to first play with the <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> function to make sure you are telling R exactly which columns to pivot into the longer format. For example, before working out the <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> code for the above example, we would figure this out first:</p>
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"Female|Male"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  Female_1990 Female_2017 Male_1990 Male_2017
        &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1        7.3         4.91      8.06      5.47
2        1.41        1.42      2.84      3.05
3       12.8        19.2      13.9      21.7 </code></pre>
</div>
</div>
<p>Then, knowing that <code>matches("Female|Male")</code> works as expected inside our little <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> test, we can copy-paste it into <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> and add the <code>names_to</code> and <code>values_to</code> arguments. Both of these arguments are new column names that you can make up (in the above example, we are using “sex_year” and “deaths_millions”).</p>
</section><section id="separate-a-column-into-multiple-columns" class="level3"><h3 class="anchored" data-anchor-id="separate-a-column-into-multiple-columns">
<code>separate()</code> a column into multiple columns</h3>
<p>While <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> did a great job fetching the different observations that were spread across multiple columns into a single one, it’s still a combination of two variables - sex and year. We can use the <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> function to deal with that.</p>
<div class="cell">
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># same pivot_longer as before</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"Female|Male"</span><span class="op">)</span>, </span>
<span>               names_to <span class="op">=</span> <span class="st">"sex_year"</span>, </span>
<span>               values_to <span class="op">=</span> <span class="st">"deaths_millions"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">sex_year</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"year"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span>, convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
   cause                     sex     year deaths_millions
   &lt;chr&gt;                     &lt;chr&gt;  &lt;int&gt;           &lt;dbl&gt;
 1 Communicable diseases     Female  1990            7.3 
 2 Communicable diseases     Female  2017            4.91
 3 Communicable diseases     Male    1990            8.06
 4 Communicable diseases     Male    2017            5.47
 5 Injuries                  Female  1990            1.41
 6 Injuries                  Female  2017            1.42
 7 Injuries                  Male    1990            2.84
 8 Injuries                  Male    2017            3.05
 9 Non-communicable diseases Female  1990           12.8 
10 Non-communicable diseases Female  2017           19.2 
11 Non-communicable diseases Male    1990           13.9 
12 Non-communicable diseases Male    2017           21.7 </code></pre>
</div>
</div>
<p>We’ve also added <code>convert = TRUE</code> to <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> so <code>year</code> would get converted into a numeric variable. The combination of, e.g., “Female-1990” is a character variable, so after separating them both <code>sex</code> and <code>year</code> would still be classified as characters. But the <code>convert = TRUE</code> recognises that <code>year</code> is a number and will appropriately convert it into an integer.</p>
</section></section><section id="arrange-rows" class="level2"><h2 class="anchored" data-anchor-id="arrange-rows">
<code>arrange()</code> rows</h2>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> function sorts rows based on the column(s) you want. By default, it arranges the tibble in ascending order:</p>
<div class="cell">
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">deaths_millions</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># first 3 rows just for printing:</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  cause     year sex    deaths_millions
  &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
1 Injuries  1990 Female            1.41
2 Injuries  2017 Female            1.42
3 Injuries  1990 Male              2.84</code></pre>
</div>
</div>
<p>For numeric variables, we can just use a <code>-</code> to sort in descending order:</p>
<div class="cell">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">deaths_millions</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  cause                      year sex    deaths_millions
  &lt;chr&gt;                     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
1 Non-communicable diseases  2017 Male              21.7
2 Non-communicable diseases  2017 Female            19.2
3 Non-communicable diseases  1990 Male              13.9</code></pre>
</div>
</div>
<p>The <code>-</code> doesn’t work for categorical variables; they need to be put in <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code> for arranging in descending order:</p>
<div class="cell">
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># printing rows 1, 2, 11, and 12</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>, <span class="fl">11</span>, <span class="fl">12</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  cause                      year sex    deaths_millions
  &lt;chr&gt;                     &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
1 Communicable diseases      1990 Male              8.06
2 Communicable diseases      2017 Male              5.47
3 Non-communicable diseases  1990 Female           12.8 
4 Non-communicable diseases  2017 Female           19.2 </code></pre>
</div>
</div>
<section id="factor-levels" class="level3"><h3 class="anchored" data-anchor-id="factor-levels">Factor levels</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> sorts characters alphabetically, whereas factors will be sorted by the order of their levels. Let’s make the cause column into a factor:</p>
<div class="cell">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_factored</span> <span class="op">&lt;-</span> <span class="va">gbd_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cause <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cause</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When we first create a factor, its levels will be ordered alphabetically:</p>
<div class="cell">
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_factored</span><span class="op">$</span><span class="va">cause</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Communicable diseases"     "Injuries"                 
[3] "Non-communicable diseases"</code></pre>
</div>
</div>
<p>But we can now use <code><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel()</a></code> inside <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to change the order of these levels:</p>
<div class="cell">
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_factored</span> <span class="op">&lt;-</span> <span class="va">gbd_factored</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cause <span class="op">=</span> <span class="va">cause</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>           <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="st">"Injuries"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gbd_factored</span><span class="op">$</span><span class="va">cause</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Injuries"                  "Communicable diseases"    
[3] "Non-communicable diseases"</code></pre>
</div>
</div>
<p><code><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel()</a></code> brings the level(s) listed in it to the front.</p>
<p>So if we use <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> on <code>gbd_factored</code>, the <code>cause</code> column will be sorted based on the order of its levels, not alphabetically. This is especially useful in two places:</p>
<ul>
<li>plotting - categorical variables that are characters will be ordered alphabetically (e.g., think barplots), regardless of whether the rows are arranged or not;</li>
<li>statistical tests - the reference level of categorical variables that are characters is the alphabetically first (e.g., what the odds ratio is relative to).</li>
</ul>
<p>However, making a character column into a factor gives us power to give its levels a non-alphabetical order, giving us control over plotting order or defining our reference levels for use in statistical tests.</p>
</section></section><section id="exercises" class="level2"><h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<section id="exercise---pivot_wider" class="level3"><h3 class="anchored" data-anchor-id="exercise---pivot_wider">Exercise - <code>pivot_wider()</code>
</h3>
<p>Using the GBD dataset with variables <code>cause</code>, <code>year</code> (1990 and 2017 only), <code>sex</code> :</p>
<div class="cell">
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"global_burden_disease_cause-year-sex.csv"</span><span class="op">)</span>  <span class="co">#add your wd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> to put the <code>cause</code> variable into columns using the <code>deaths_millions</code> as values:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
   year sex    `Communicable diseases` Injuries `Non-communicable diseases`
  &lt;dbl&gt; &lt;chr&gt;                    &lt;dbl&gt;    &lt;dbl&gt;                       &lt;dbl&gt;
1  1990 Female                    7.3      1.41                        12.8
2  2017 Female                    4.91     1.42                        19.2
3  1990 Male                      8.06     2.84                        13.9
4  2017 Male                      5.47     3.05                        21.7</code></pre>
</div>
</div>
<p><strong>Solution</strong></p>
<div class="cell">
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"global_burden_disease_cause-year-sex.csv"</span><span class="op">)</span></span>
<span><span class="va">gbd_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">cause</span>, values_from <span class="op">=</span> <span class="va">deaths_millions</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="exercise---group_by-summarise" class="level3"><h3 class="anchored" data-anchor-id="exercise---group_by-summarise">Exercise - <code>group_by()</code>, <code>summarise()</code>
</h3>
<p>Read in the full GBD dataset with variables <code>cause</code>, <code>year</code>, <code>sex</code>, <code>income</code>, <code>deaths_millions</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"global_burden_disease_cause-year-sex-income.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">gbd_full</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 168
Columns: 5
$ cause           &lt;chr&gt; "Communicable diseases", "Communicable diseases", "Com…
$ year            &lt;dbl&gt; 1990, 1990, 1990, 1990, 1990, 1990, 1990, 1990, 1990, …
$ sex             &lt;chr&gt; "Female", "Female", "Female", "Female", "Male", "Male"…
$ income          &lt;chr&gt; "High", "Upper-Middle", "Lower-Middle", "Low", "High",…
$ deaths_millions &lt;dbl&gt; 0.21, 1.15, 4.43, 1.51, 0.26, 1.35, 4.73, 1.72, 0.20, …</code></pre>
</div>
</div>
<p>Year 2017 of this dataset was shown before but we have multiple years avaiable: 1990, 1995, 2000, 2005, 2010, 2015, 2017.</p>
<p>Investigate these code examples:</p>
<div class="cell">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">summary_data1</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">gbd_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total_per_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_millions</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">summary_data1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
   year total_per_year
  &lt;dbl&gt;          &lt;dbl&gt;
1  1990           46.3
2  1995           48.9
3  2000           50.4
4  2005           51.2
5  2010           52.6
6  2015           54.6
7  2017           55.7</code></pre>
</div>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">summary_data2</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">gbd_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">cause</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total_per_cause <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_millions</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'year'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">summary_data2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 3
# Groups:   year [7]
    year cause                     total_per_cause
   &lt;dbl&gt; &lt;chr&gt;                               &lt;dbl&gt;
 1  1990 Communicable diseases               15.4 
 2  1990 Injuries                             4.25
 3  1990 Non-communicable diseases           26.7 
 4  1995 Communicable diseases               15.1 
 5  1995 Injuries                             4.53
 6  1995 Non-communicable diseases           29.3 
 7  2000 Communicable diseases               14.8 
 8  2000 Injuries                             4.56
 9  2000 Non-communicable diseases           31.0 
10  2005 Communicable diseases               13.9 
# ℹ 11 more rows</code></pre>
</div>
</div>
<p>You should recognise that:</p>
<ul>
<li>
<code>summary_data1</code> includes the total number of deaths per year.</li>
<li>
<code>summary_data2</code> includes the number of deaths per cause per year.</li>
<li>
<code>summary_data1 &lt;-</code> means we are creating a new dataframe called <code>summary_data1</code> and saving (<code>&lt;-</code>) results into it. If <code>summary_data1</code> was a dataframe that already existed, it would get overwritten.</li>
<li>
<code>gbd_full</code> is the data being sent to the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and then <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> functions.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> tells <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> that we want aggregated results for each year.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> then creates a new variable called <code>total_per_year</code> that sums the deaths from each different observation (subcategory) together.</li>
<li>Calling <code>summary_data1</code> on a separate line gets it printed.</li>
<li>We then do something similar in <code>summary_data2</code>.</li>
</ul>
<p>Compare the number of rows (observations) and number of columns (variables) of <code>gbd_full</code>, <code>summary_data1</code>, and <code>summary_data2</code>.</p>
<p>You should notice that:</p>
<ul>
<li>
<code>summary_data2</code> has exactly 3 times as many rows (observations) as <code>summary_data1</code>. Why?</li>
<li>
<code>gbd_full</code> has 5 variables, whereas the summarised tibbles have 2 and 3. Which variables got dropped? How?</li>
</ul>
<p><strong>Answers</strong></p>
<ul>
<li>
<code>gbd_full</code> has 168 observations (rows),</li>
<li>
<code>summary_data1</code> has 7,</li>
<li>
<code>summary_data2</code> has 21.</li>
</ul>
<p><code>summary_data1</code> was grouped by year, therefore it includes a (summarised) value for each year in the original dataset. <code>summary_data2</code> was grouped by year and cause (Communicable diseases, Injuries, Non-communicable diseases), so it has 3 values for each year.</p>
<p>The columns a <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> function returns are: variables listed in <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> + variables created inside <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> (e.g., in this case <code>deaths_peryear</code>). All others get aggregated.</p>
</section><section id="exercise---full_join-percent" class="level3"><h3 class="anchored" data-anchor-id="exercise---full_join-percent">Exercise - <code>full_join()</code>, <code>percent()</code>
</h3>
<p>For each cause, calculate its percentage to total deaths in each year.</p>
<p>Hint: Use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code> on <code>summary_data1</code> and <code>summary_data2</code>, and then use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to add a new column called <code>percentage</code>.</p>
<p>Example result for a single year:</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(year)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
   year total_per_year cause                     total_per_cause percentage
  &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;                               &lt;dbl&gt; &lt;chr&gt;     
1  1990           46.3 Communicable diseases               15.4  33.161%   
2  1990           46.3 Injuries                             4.25 9.175%    
3  1990           46.3 Non-communicable diseases           26.7  57.664%   </code></pre>
</div>
</div>
<p><strong>Solution</strong></p>
<div class="cell">
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">summary_data1</span>, <span class="va">summary_data2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>percentage <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="va">total_per_cause</span><span class="op">/</span><span class="va">total_per_year</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="exercise---mutate-summarise" class="level3"><h3 class="anchored" data-anchor-id="exercise---mutate-summarise">Exercise - <code>mutate()</code>, <code>summarise()</code>
</h3>
<p>Instead of creating the two summarised tibbles and using a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code>, achieve the same result as in the previous exercise with a single pipeline using <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> and then <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>.</p>
<p>Hint: you have to do it the other way around, so <code>group_by(year, cause) %&gt;% summarise(...)</code> first, then <code>group_by(year) %&gt;% mutate()</code>.</p>
<p>Bonus: <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> columns <code>year</code>, <code>cause</code>, <code>percentage</code>, then <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> the <code>cause</code> variable using <code>percentage</code> as values.</p>
<p><strong>Solution</strong></p>
<div class="cell">
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># aggregate to deaths per cause per year using summarise()</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">cause</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total_per_cause <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_millions</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># then add a column of yearly totals using mutate()</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>total_per_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">total_per_cause</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># add the percentage column</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>percentage <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="va">total_per_cause</span><span class="op">/</span><span class="va">total_per_year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># select the final variables for better vieweing</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">cause</span>, <span class="va">percentage</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">cause</span>, values_from <span class="op">=</span> <span class="va">percentage</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'year'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 4
# Groups:   year [7]
   year `Communicable diseases` Injuries `Non-communicable diseases`
  &lt;dbl&gt; &lt;chr&gt;                   &lt;chr&gt;    &lt;chr&gt;                      
1  1990 33%                     9%       58%                        
2  1995 31%                     9%       60%                        
3  2000 29%                     9%       62%                        
4  2005 27%                     9%       64%                        
5  2010 24%                     9%       67%                        
6  2015 20%                     8%       72%                        
7  2017 19%                     8%       73%                        </code></pre>
</div>
</div>
<p>Note that your pipelines shouldn’t be much longer than this, and we often save interim results into separate tibbles for checking (like we did with <code>summary_data1</code> and <code>summary_data2</code>, making sure the number of rows are what we expect and spot checking that the calculation worked as expected).</p>
<blockquote class="blockquote">
<p>R doesn’t do what you want it to do, it does what you ask it to do. Testing and spot checking is essential as you will make mistakes. We sure do.</p>
</blockquote>
<p>Do not feel like you should be able to just bash out these clever pipelines without a lot of trial and error first.</p>
</section><section id="exercise---filter-summarise-pivot_wider" class="level3"><h3 class="anchored" data-anchor-id="exercise---filter-summarise-pivot_wider">Exercise - <code>filter()</code>, <code>summarise()</code>, <code>pivot_wider()</code>
</h3>
<p>Still working with <code>gbd_full</code>:</p>
<ul>
<li><p>Filter for 1990.</p></li>
<li><p>Calculate the total number of deaths in the different income groups (High, Upper-Middle, Lower-Middle, Low). Hint: use <code>group_by(income)</code> and <code>summarise(new_column_name = sum(variable))</code>.</p></li>
<li><p>Calculate the total number of deaths within each income group for males and females. Hint: this is as easy as adding <code>, sex</code> to <code>group_by(income)</code>.</p></li>
<li><p><code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> the <code>income</code> column.</p></li>
</ul>
<p><strong>Solution</strong></p>
<div class="cell">
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gbd_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">1990</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">income</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total_deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">deaths_millions</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">income</span>, values_from <span class="op">=</span> <span class="va">total_deaths</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'income'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  sex     High   Low `Lower-Middle` `Upper-Middle`
  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;
1 Female  4.14  2.22           8.47           6.68
2 Male    4.46  2.57           9.83           7.95</code></pre>
</div>
</div>


<!-- -->

</section></section><a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./EDA_Practical3.html" class="pagination-link" aria-label="Data Transformation - Python">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Data Transformation - Python</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb107" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data wrangling with R</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>This code is based on the original work from <span class="co">[</span><span class="ot">HealthyR</span><span class="co">](https://healthyr.surgicalinformatics.org)</span> and has been adapted by **Laura Bravo**</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="fu">### Tidyverse packages: ggplot2, dplyr, tidyr, etc.</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>Most of the functions introduced in this session come from the <span class="co">[</span><span class="ot">tidyverse family</span><span class="co">](http://tidyverse.org/)</span>, rather than Base R. Including <span class="in">`library(tidyverse)`</span> in your script loads a list of packages: ggplot2, dplyr, tidyr, forcats, etc.</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>In this session we will get to know key functions to work with data:</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>summarise data using: <span class="in">`group_by()`</span>, <span class="in">`summarise()`</span>, and <span class="in">`mutate()`</span>;</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>reshape data between the wide and long formats: <span class="in">`pivot_wider()`</span> and <span class="in">`pivot_longer()`</span>;</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`select()`</span> columns and <span class="in">`arrange()`</span> (sort) rows.</span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>We are using a condensed version of the <span class="co">[</span><span class="ot">Global Burden of Disease Data</span><span class="co">](https://ghdx.healthdata.org)</span> dataset.</span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a><span class="co">#Can load the dataset through many ways but quickest and one i always resort to, is data.table function</span></span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a>gbd_full <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"global_burden_disease_cause-year-sex-income.csv"</span>) <span class="co">#add your working directory</span></span>
<span id="cb107-32"><a href="#cb107-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-33"><a href="#cb107-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-36"><a href="#cb107-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-37"><a href="#cb107-37" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gbd_full)</span>
<span id="cb107-38"><a href="#cb107-38" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-39"><a href="#cb107-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-42"><a href="#cb107-42" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-43"><a href="#cb107-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a single-year tibble for printing and simple examples:</span></span>
<span id="cb107-44"><a href="#cb107-44" aria-hidden="true" tabindex="-1"></a>gbd2017 <span class="ot">&lt;-</span> gbd_full <span class="sc">%&gt;%</span> </span>
<span id="cb107-45"><a href="#cb107-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="st">"2017"</span>)</span>
<span id="cb107-46"><a href="#cb107-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-47"><a href="#cb107-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-48"><a href="#cb107-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-49"><a href="#cb107-49" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plot the data</span></span>
<span id="cb107-50"><a href="#cb107-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-51"><a href="#cb107-51" aria-hidden="true" tabindex="-1"></a>The best way to investigate a dataset is to plot it (do not worry if do not understand the code, will do a separate exercise on plotting later)</span>
<span id="cb107-52"><a href="#cb107-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-55"><a href="#cb107-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-56"><a href="#cb107-56" aria-hidden="true" tabindex="-1"></a>gbd2017 <span class="sc">%&gt;%</span> </span>
<span id="cb107-57"><a href="#cb107-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># without the mutate(... = fct_relevel()) </span></span>
<span id="cb107-58"><a href="#cb107-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the panels get ordered alphabetically</span></span>
<span id="cb107-59"><a href="#cb107-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">income =</span> <span class="fu">fct_relevel</span>(income,</span>
<span id="cb107-60"><a href="#cb107-60" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Low"</span>,</span>
<span id="cb107-61"><a href="#cb107-61" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Lower-Middle"</span>,</span>
<span id="cb107-62"><a href="#cb107-62" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Upper-Middle"</span>,</span>
<span id="cb107-63"><a href="#cb107-63" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"High"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-64"><a href="#cb107-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># defining the variables using ggplot(aes(...)):</span></span>
<span id="cb107-65"><a href="#cb107-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sex, <span class="at">y =</span> deaths_millions, <span class="at">fill =</span> cause)) <span class="sc">+</span></span>
<span id="cb107-66"><a href="#cb107-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># type of geom to be used: column (that's a type of barplot):</span></span>
<span id="cb107-67"><a href="#cb107-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb107-68"><a href="#cb107-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facets for the income groups:</span></span>
<span id="cb107-69"><a href="#cb107-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>income, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb107-70"><a href="#cb107-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># move the legend to the top of the plot (default is "right"):</span></span>
<span id="cb107-71"><a href="#cb107-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb107-72"><a href="#cb107-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-73"><a href="#cb107-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-74"><a href="#cb107-74" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aggregating: `group_by()`, `summarise()`</span></span>
<span id="cb107-75"><a href="#cb107-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-76"><a href="#cb107-76" aria-hidden="true" tabindex="-1"></a>Health data analysis is frequently concerned with making comparisons between groups. Groups of genes, or diseases, or patients, or populations, etc. An easy approach to the comparison of data by a categorical grouping is therefore essential.</span>
<span id="cb107-77"><a href="#cb107-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-78"><a href="#cb107-78" aria-hidden="true" tabindex="-1"></a>We will introduce flexible functions from **tidyverse** that you can apply in any setting.</span>
<span id="cb107-79"><a href="#cb107-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-80"><a href="#cb107-80" aria-hidden="true" tabindex="-1"></a>To quickly calculate the total number of deaths in 2017, we can select the column and send it into the <span class="in">`sum()`</span> function:</span>
<span id="cb107-81"><a href="#cb107-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-84"><a href="#cb107-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-85"><a href="#cb107-85" aria-hidden="true" tabindex="-1"></a>gbd2017<span class="sc">$</span>deaths_millions <span class="sc">%&gt;%</span> <span class="fu">sum</span>()</span>
<span id="cb107-86"><a href="#cb107-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-87"><a href="#cb107-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-88"><a href="#cb107-88" aria-hidden="true" tabindex="-1"></a>But a much cleverer way of summarising data is using the <span class="in">`summarise()`</span> function:</span>
<span id="cb107-89"><a href="#cb107-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-92"><a href="#cb107-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-93"><a href="#cb107-93" aria-hidden="true" tabindex="-1"></a>gbd2017 <span class="sc">%&gt;%</span> </span>
<span id="cb107-94"><a href="#cb107-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">sum</span>(deaths_millions))</span>
<span id="cb107-95"><a href="#cb107-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-96"><a href="#cb107-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-97"><a href="#cb107-97" aria-hidden="true" tabindex="-1"></a><span class="in">`sum()`</span> is a function that adds numbers together, whereas <span class="in">`summarise()`</span> is an efficient way of creating summarised dataframes. The main strength of <span class="in">`summarise()`</span> is how it works with the <span class="in">`group_by()`</span> function. <span class="in">`group_by()`</span> and <span class="in">`summarise()`</span> are a perfect complement for each other and used togetehr most of the time.</span>
<span id="cb107-98"><a href="#cb107-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-99"><a href="#cb107-99" aria-hidden="true" tabindex="-1"></a>We use <span class="in">`group_by()`</span> to tell <span class="in">`summarise()`</span> which subgroups to apply the calculations on. In the above example, without <span class="in">`group_by()`</span>, summarise just works on the whole dataset, yielding the same result as just sending a single column into the <span class="in">`sum()`</span> function.</span>
<span id="cb107-100"><a href="#cb107-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-101"><a href="#cb107-101" aria-hidden="true" tabindex="-1"></a>We can subset on the cause variable using <span class="in">`group_by()`</span>:</span>
<span id="cb107-102"><a href="#cb107-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-105"><a href="#cb107-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-106"><a href="#cb107-106" aria-hidden="true" tabindex="-1"></a>gbd2017 <span class="sc">%&gt;%</span> </span>
<span id="cb107-107"><a href="#cb107-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cause) <span class="sc">%&gt;%</span> </span>
<span id="cb107-108"><a href="#cb107-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">sum</span>(deaths_millions))</span>
<span id="cb107-109"><a href="#cb107-109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-110"><a href="#cb107-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-111"><a href="#cb107-111" aria-hidden="true" tabindex="-1"></a>Furthermore, <span class="in">`group_by()`</span> is happy to accept multiple grouping variables. So by just copying and editing the above code, we can quickly get summarised totals across multiple grouping variables (by just adding <span class="in">`sex`</span> inside the <span class="in">`group_by()`</span> after <span class="in">`cause`</span>):</span>
<span id="cb107-112"><a href="#cb107-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-115"><a href="#cb107-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-116"><a href="#cb107-116" aria-hidden="true" tabindex="-1"></a>gbd2017 <span class="sc">%&gt;%</span> </span>
<span id="cb107-117"><a href="#cb107-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cause, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb107-118"><a href="#cb107-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">sum</span>(deaths_millions))</span>
<span id="cb107-119"><a href="#cb107-119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-120"><a href="#cb107-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-121"><a href="#cb107-121" aria-hidden="true" tabindex="-1"></a><span class="fu">## Add new columns: `mutate()`</span></span>
<span id="cb107-122"><a href="#cb107-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-123"><a href="#cb107-123" aria-hidden="true" tabindex="-1"></a>Let's first give the summarised column a better name, e.g., <span class="in">`deaths_per_group`</span>. We can remove groupings by using <span class="in">`ungroup()`</span>. This is important to remember if you want to manipulate the dataset in its original format. We can combine <span class="in">`ungroup()`</span> with <span class="in">`mutate()`</span> to add a total deaths column, which will be used below to calculate a percentage:</span>
<span id="cb107-124"><a href="#cb107-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-127"><a href="#cb107-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-128"><a href="#cb107-128" aria-hidden="true" tabindex="-1"></a>gbd2017 <span class="sc">%&gt;%</span> </span>
<span id="cb107-129"><a href="#cb107-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cause, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb107-130"><a href="#cb107-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">deaths_per_group =</span> <span class="fu">sum</span>(deaths_millions)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-131"><a href="#cb107-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb107-132"><a href="#cb107-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deaths_total =</span> <span class="fu">sum</span>(deaths_per_group))</span>
<span id="cb107-133"><a href="#cb107-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-134"><a href="#cb107-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-135"><a href="#cb107-135" aria-hidden="true" tabindex="-1"></a>So <span class="in">`summarise()`</span> condenses a dataframe, whereas <span class="in">`mutate()`</span> retains its current size and adds columns.</span>
<span id="cb107-136"><a href="#cb107-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-137"><a href="#cb107-137" aria-hidden="true" tabindex="-1"></a><span class="fu">### Percentages formatting: `percent()`</span></span>
<span id="cb107-138"><a href="#cb107-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-139"><a href="#cb107-139" aria-hidden="true" tabindex="-1"></a>We can also add further lines to <span class="in">`mutate()`</span> to calculate the percentage of each group:</span>
<span id="cb107-140"><a href="#cb107-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-141"><a href="#cb107-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb107-142"><a href="#cb107-142" aria-hidden="true" tabindex="-1"></a><span class="co"># percent() function for formatting percentages come from library(scales)</span></span>
<span id="cb107-143"><a href="#cb107-143" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb107-144"><a href="#cb107-144" aria-hidden="true" tabindex="-1"></a>gbd2017_summarised <span class="ot">&lt;-</span> gbd2017 <span class="sc">%&gt;%</span> </span>
<span id="cb107-145"><a href="#cb107-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cause, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb107-146"><a href="#cb107-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">deaths_per_group =</span> <span class="fu">sum</span>(deaths_millions)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-147"><a href="#cb107-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb107-148"><a href="#cb107-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deaths_total    =</span> <span class="fu">sum</span>(deaths_per_group),</span>
<span id="cb107-149"><a href="#cb107-149" aria-hidden="true" tabindex="-1"></a>        <span class="at">deaths_relative =</span> deaths_per_group<span class="sc">/</span>deaths_total)</span>
<span id="cb107-150"><a href="#cb107-150" aria-hidden="true" tabindex="-1"></a>gbd2017_summarised</span>
<span id="cb107-151"><a href="#cb107-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-152"><a href="#cb107-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-153"><a href="#cb107-153" aria-hidden="true" tabindex="-1"></a><span class="fu">## `summarise()` vs `mutate()`</span></span>
<span id="cb107-154"><a href="#cb107-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-155"><a href="#cb107-155" aria-hidden="true" tabindex="-1"></a>So far we've shown you examples of using <span class="in">`summarise()`</span> on grouped data (following <span class="in">`group_by()`</span>) and <span class="in">`mutate()`</span> on the whole dataset (without using <span class="in">`group_by()`</span>).</span>
<span id="cb107-156"><a href="#cb107-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-157"><a href="#cb107-157" aria-hidden="true" tabindex="-1"></a>But here's the thing: <span class="in">`mutate()`</span> is also happy to work on grouped data.</span>
<span id="cb107-158"><a href="#cb107-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-159"><a href="#cb107-159" aria-hidden="true" tabindex="-1"></a>Let's save the aggregated example from above in a new dataframe. We will then sort the rows using <span class="in">`arrange()`</span> based on <span class="in">`sex`</span>, just for easier viewing (it was previously sorted by <span class="in">`cause`</span>).</span>
<span id="cb107-160"><a href="#cb107-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-161"><a href="#cb107-161" aria-hidden="true" tabindex="-1"></a>The <span class="in">`arrange()`</span> function sorts the rows within a tibble:</span>
<span id="cb107-162"><a href="#cb107-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-165"><a href="#cb107-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-166"><a href="#cb107-166" aria-hidden="true" tabindex="-1"></a>gbd_summarised <span class="ot">&lt;-</span> gbd2017 <span class="sc">%&gt;%</span> </span>
<span id="cb107-167"><a href="#cb107-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cause, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb107-168"><a href="#cb107-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">deaths_per_group =</span> <span class="fu">sum</span>(deaths_millions)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-169"><a href="#cb107-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(sex)</span>
<span id="cb107-170"><a href="#cb107-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-171"><a href="#cb107-171" aria-hidden="true" tabindex="-1"></a>gbd_summarised</span>
<span id="cb107-172"><a href="#cb107-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-173"><a href="#cb107-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-174"><a href="#cb107-174" aria-hidden="true" tabindex="-1"></a>You should also notice that <span class="in">`summarise()`</span> drops all variables that are not listed in <span class="in">`group_by()`</span> or created inside it. So <span class="in">`year`</span>, <span class="in">`income`</span>, and <span class="in">`deaths_millions`</span> exist in <span class="in">`gbd2017`</span>, but they do not exist in <span class="in">`gbd_summarised`</span>.</span>
<span id="cb107-175"><a href="#cb107-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-176"><a href="#cb107-176" aria-hidden="true" tabindex="-1"></a>We now want to calculate the percentage of deaths from each cause for each gender. We could use <span class="in">`summarise()`</span> to calculate the totals:</span>
<span id="cb107-177"><a href="#cb107-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-180"><a href="#cb107-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-181"><a href="#cb107-181" aria-hidden="true" tabindex="-1"></a>gbd_summarised_sex <span class="ot">&lt;-</span> gbd_summarised <span class="sc">%&gt;%</span> </span>
<span id="cb107-182"><a href="#cb107-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span> </span>
<span id="cb107-183"><a href="#cb107-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">deaths_per_sex =</span> <span class="fu">sum</span>(deaths_per_group))</span>
<span id="cb107-184"><a href="#cb107-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-185"><a href="#cb107-185" aria-hidden="true" tabindex="-1"></a>gbd_summarised_sex</span>
<span id="cb107-186"><a href="#cb107-186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-187"><a href="#cb107-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-188"><a href="#cb107-188" aria-hidden="true" tabindex="-1"></a>But that drops the <span class="in">`cause`</span> and <span class="in">`deaths_per_group`</span> columns. One way would be to now use a join on <span class="in">`gbd_summarised`</span> and <span class="in">`gbd_summarised_sex`</span>:</span>
<span id="cb107-189"><a href="#cb107-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-192"><a href="#cb107-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-193"><a href="#cb107-193" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(gbd_summarised, gbd_summarised_sex)</span>
<span id="cb107-194"><a href="#cb107-194" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-195"><a href="#cb107-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-196"><a href="#cb107-196" aria-hidden="true" tabindex="-1"></a>Joining different summaries together can be useful, especially if the individual pipelines are quite long (e.g., over 5 lines of <span class="in">`%&gt;%`</span>). However, it does increase the chance of mistakes creeping in and is best avoided if possible.</span>
<span id="cb107-197"><a href="#cb107-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-198"><a href="#cb107-198" aria-hidden="true" tabindex="-1"></a>An alternative is to use <span class="in">`mutate()`</span> with <span class="in">`group_by()`</span> to achieve the same result as the <span class="in">`full_join()`</span> above:</span>
<span id="cb107-199"><a href="#cb107-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-202"><a href="#cb107-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-203"><a href="#cb107-203" aria-hidden="true" tabindex="-1"></a>gbd_summarised <span class="sc">%&gt;%</span> </span>
<span id="cb107-204"><a href="#cb107-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span> </span>
<span id="cb107-205"><a href="#cb107-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deaths_per_sex =</span> <span class="fu">sum</span>(deaths_per_group))</span>
<span id="cb107-206"><a href="#cb107-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-207"><a href="#cb107-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-208"><a href="#cb107-208" aria-hidden="true" tabindex="-1"></a>So <span class="in">`mutate()`</span> calculates the sums within each grouping variable (in this example just <span class="in">`group_by(sex)`</span>) and puts the results in a new column without condensing the tibble down or removing any of the existing columns.</span>
<span id="cb107-209"><a href="#cb107-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-210"><a href="#cb107-210" aria-hidden="true" tabindex="-1"></a>Let's combine all of this together into a single pipeline and calculate the percentages per cause for each gender:</span>
<span id="cb107-211"><a href="#cb107-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-214"><a href="#cb107-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-215"><a href="#cb107-215" aria-hidden="true" tabindex="-1"></a>gbd2017 <span class="sc">%&gt;%</span> </span>
<span id="cb107-216"><a href="#cb107-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cause, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb107-217"><a href="#cb107-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">deaths_per_group =</span> <span class="fu">sum</span>(deaths_millions)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-218"><a href="#cb107-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span> </span>
<span id="cb107-219"><a href="#cb107-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deaths_per_sex  =</span> <span class="fu">sum</span>(deaths_per_group),</span>
<span id="cb107-220"><a href="#cb107-220" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex_cause_perc =</span> <span class="fu">percent</span>(deaths_per_group<span class="sc">/</span>deaths_per_sex)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-221"><a href="#cb107-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(sex, deaths_per_group)</span>
<span id="cb107-222"><a href="#cb107-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-223"><a href="#cb107-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-224"><a href="#cb107-224" aria-hidden="true" tabindex="-1"></a><span class="fu">## Common arithmetic functions - `sum()`, `mean()`, `median()`, etc.</span></span>
<span id="cb107-225"><a href="#cb107-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-226"><a href="#cb107-226" aria-hidden="true" tabindex="-1"></a>Statistics is an R strength, so if there is an arithmetic function you can think of, it probably exists in R.</span>
<span id="cb107-227"><a href="#cb107-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-228"><a href="#cb107-228" aria-hidden="true" tabindex="-1"></a>The most common ones are:</span>
<span id="cb107-229"><a href="#cb107-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-230"><a href="#cb107-230" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`sum()`</span></span>
<span id="cb107-231"><a href="#cb107-231" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`mean()`</span></span>
<span id="cb107-232"><a href="#cb107-232" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`median()`</span></span>
<span id="cb107-233"><a href="#cb107-233" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`min()`</span>, <span class="in">`max()`</span></span>
<span id="cb107-234"><a href="#cb107-234" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`sd()`</span> - standard deviation</span>
<span id="cb107-235"><a href="#cb107-235" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`IQR()`</span> - interquartile range</span>
<span id="cb107-236"><a href="#cb107-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-237"><a href="#cb107-237" aria-hidden="true" tabindex="-1"></a>An import thing to remember relates to missing data: if any of your values is NA (not available; missing), these functions will return an NA. Either deal with your missing values beforehand (recommended) or add the <span class="in">`na.rm = TRUE`</span> argument into any of the functions to ask R to ignore missing values.</span>
<span id="cb107-238"><a href="#cb107-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-241"><a href="#cb107-241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-242"><a href="#cb107-242" aria-hidden="true" tabindex="-1"></a>mynumbers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>)</span>
<span id="cb107-243"><a href="#cb107-243" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mynumbers)</span>
<span id="cb107-244"><a href="#cb107-244" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mynumbers, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-245"><a href="#cb107-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-246"><a href="#cb107-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-247"><a href="#cb107-247" aria-hidden="true" tabindex="-1"></a><span class="fu">## `select()` columns</span></span>
<span id="cb107-248"><a href="#cb107-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-249"><a href="#cb107-249" aria-hidden="true" tabindex="-1"></a>The <span class="in">`select()`</span> function can be used to choose, rename, or reorder columns of a tibble.</span>
<span id="cb107-250"><a href="#cb107-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-251"><a href="#cb107-251" aria-hidden="true" tabindex="-1"></a>For the following <span class="in">`select()`</span> examples, let's create a new tibble called <span class="in">`gbd_2rows`</span> by taking the first 2 rows of <span class="in">`gbd_full`</span> (just for shorter printing):</span>
<span id="cb107-252"><a href="#cb107-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-255"><a href="#cb107-255" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-256"><a href="#cb107-256" aria-hidden="true" tabindex="-1"></a>gbd_2rows <span class="ot">&lt;-</span> gbd_full <span class="sc">%&gt;%</span> </span>
<span id="cb107-257"><a href="#cb107-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb107-258"><a href="#cb107-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-259"><a href="#cb107-259" aria-hidden="true" tabindex="-1"></a>gbd_2rows</span>
<span id="cb107-260"><a href="#cb107-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-261"><a href="#cb107-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-262"><a href="#cb107-262" aria-hidden="true" tabindex="-1"></a>Let's <span class="in">`select()`</span> two of these columns:</span>
<span id="cb107-263"><a href="#cb107-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-266"><a href="#cb107-266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-267"><a href="#cb107-267" aria-hidden="true" tabindex="-1"></a>gbd_2rows <span class="sc">%&gt;%</span> </span>
<span id="cb107-268"><a href="#cb107-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cause, deaths_millions)</span>
<span id="cb107-269"><a href="#cb107-269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-270"><a href="#cb107-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-271"><a href="#cb107-271" aria-hidden="true" tabindex="-1"></a>We can also use <span class="in">`select()`</span> to rename the columns we are choosing:</span>
<span id="cb107-272"><a href="#cb107-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-275"><a href="#cb107-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-276"><a href="#cb107-276" aria-hidden="true" tabindex="-1"></a>gbd_2rows <span class="sc">%&gt;%</span> </span>
<span id="cb107-277"><a href="#cb107-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cause, <span class="at">deaths =</span> deaths_millions)</span>
<span id="cb107-278"><a href="#cb107-278" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-279"><a href="#cb107-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-280"><a href="#cb107-280" aria-hidden="true" tabindex="-1"></a>The function <span class="in">`rename()`</span> is similar to <span class="in">`select()`</span>, but it keeps all variables whereas <span class="in">`select()`</span> only kept the ones we mentioned:</span>
<span id="cb107-281"><a href="#cb107-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-284"><a href="#cb107-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-285"><a href="#cb107-285" aria-hidden="true" tabindex="-1"></a>gbd_2rows <span class="sc">%&gt;%</span> </span>
<span id="cb107-286"><a href="#cb107-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">deaths =</span> deaths_millions)</span>
<span id="cb107-287"><a href="#cb107-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-288"><a href="#cb107-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-289"><a href="#cb107-289" aria-hidden="true" tabindex="-1"></a><span class="in">`select()`</span> can also be used to reorder the columns in your tibble. Moving columns around is not relevant in data analysis (as any of the functions we showed you above, as well as plotting, only look at the column names, and not their positions in the tibble), but it is useful for organising your tibble for easier viewing.</span>
<span id="cb107-290"><a href="#cb107-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-291"><a href="#cb107-291" aria-hidden="true" tabindex="-1"></a>So if we use select like this:</span>
<span id="cb107-292"><a href="#cb107-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-295"><a href="#cb107-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-296"><a href="#cb107-296" aria-hidden="true" tabindex="-1"></a>gbd_2rows <span class="sc">%&gt;%</span> </span>
<span id="cb107-297"><a href="#cb107-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, sex, income, cause, deaths_millions)</span>
<span id="cb107-298"><a href="#cb107-298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-299"><a href="#cb107-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-300"><a href="#cb107-300" aria-hidden="true" tabindex="-1"></a>The columns are reordered.</span>
<span id="cb107-301"><a href="#cb107-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-302"><a href="#cb107-302" aria-hidden="true" tabindex="-1"></a>If you want to move specific column(s) to the front of the tibble, do:</span>
<span id="cb107-303"><a href="#cb107-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-306"><a href="#cb107-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-307"><a href="#cb107-307" aria-hidden="true" tabindex="-1"></a>gbd_2rows <span class="sc">%&gt;%</span> </span>
<span id="cb107-308"><a href="#cb107-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, sex, <span class="fu">everything</span>())</span>
<span id="cb107-309"><a href="#cb107-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-310"><a href="#cb107-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-311"><a href="#cb107-311" aria-hidden="true" tabindex="-1"></a>And this is where the true power of <span class="in">`select()`</span> starts to come out. In addition to listing the columns explicitly (e.g., <span class="in">`mydata %&gt;% select(year, cause...)`</span>) there are several special functions that can be used inside <span class="in">`select()`</span>. These special functions are called select helpers, and the first select helper we used is <span class="in">`everything()`</span>.</span>
<span id="cb107-312"><a href="#cb107-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-313"><a href="#cb107-313" aria-hidden="true" tabindex="-1"></a>The most common select helpers are <span class="in">`starts_with()`</span>, <span class="in">`ends_with()`</span>, <span class="in">`contains()`</span>, <span class="in">`matches()`</span> (but there are several others that may be useful to you, so press F1 on <span class="in">`select()`</span> for a full list, or search the web for more examples).</span>
<span id="cb107-314"><a href="#cb107-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-315"><a href="#cb107-315" aria-hidden="true" tabindex="-1"></a>Let's say you can't remember whether the deaths column was called <span class="in">`deaths_millions`</span> or just <span class="in">`deaths`</span> or <span class="in">`deaths_mil`</span>, or maybe there are other columns that include the word "deaths" that you want to <span class="in">`select()`</span>:</span>
<span id="cb107-316"><a href="#cb107-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-319"><a href="#cb107-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-320"><a href="#cb107-320" aria-hidden="true" tabindex="-1"></a>gbd_2rows <span class="sc">%&gt;%</span> </span>
<span id="cb107-321"><a href="#cb107-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"deaths"</span>))</span>
<span id="cb107-322"><a href="#cb107-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-323"><a href="#cb107-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-324"><a href="#cb107-324" aria-hidden="true" tabindex="-1"></a>Note how "deaths" needs to be quoted inside <span class="in">`starts_with()`</span> - as it's a word to look for, not the real name of a column/variable.</span>
<span id="cb107-325"><a href="#cb107-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-326"><a href="#cb107-326" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reshaping data - long vs wide format</span></span>
<span id="cb107-327"><a href="#cb107-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-328"><a href="#cb107-328" aria-hidden="true" tabindex="-1"></a>So far, all of the examples we've shown you have been using 'tidy' data. Data is 'tidy' when it follows a couple of rules: *each variable is in its own column*, and *each observation is in its own row*. Making data 'tidy' often means transforming the table from a "wide" format into a "long" format. Long format is efficient to use in data analysis and visualisation and can also be considered "computer readable".</span>
<span id="cb107-329"><a href="#cb107-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-330"><a href="#cb107-330" aria-hidden="true" tabindex="-1"></a>But sometimes when presenting data in tables for humans to read, or when collecting data directly into a spreadsheet, it can be convenient to have data in a wide format. Data is 'wide' when *some or all of the columns are levels of a factor*. An example makes this easier to see.</span>
<span id="cb107-331"><a href="#cb107-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-332"><a href="#cb107-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb107-333"><a href="#cb107-333" aria-hidden="true" tabindex="-1"></a>gbd_wide <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"global_burden_disease_wide-format.csv"</span>) <span class="co">#add your wd</span></span>
<span id="cb107-334"><a href="#cb107-334" aria-hidden="true" tabindex="-1"></a>gbd_long <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"global_burden_disease_cause-year-sex.csv"</span>)  <span class="do">##add your wd</span></span>
<span id="cb107-335"><a href="#cb107-335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-336"><a href="#cb107-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-339"><a href="#cb107-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-340"><a href="#cb107-340" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gbd_wide)</span>
<span id="cb107-341"><a href="#cb107-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-342"><a href="#cb107-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-343"><a href="#cb107-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-346"><a href="#cb107-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-347"><a href="#cb107-347" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gbd_long)</span>
<span id="cb107-348"><a href="#cb107-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-349"><a href="#cb107-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-350"><a href="#cb107-350" aria-hidden="true" tabindex="-1"></a>These tables contain the exact same information, but in long (tidy) and wide formats, respectively.</span>
<span id="cb107-351"><a href="#cb107-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-352"><a href="#cb107-352" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pivot values from rows into columns (wider)</span></span>
<span id="cb107-353"><a href="#cb107-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-354"><a href="#cb107-354" aria-hidden="true" tabindex="-1"></a>If we want to take the long data and put some of the numbers next to each other for easier visualisation, then <span class="in">`pivot_wider()`</span> from the **tidyr** package is the function to do it. It means we want to send a variable into columns, and it needs just two arguments: the variable we want to become the new columns, and the variable where the values currently are.</span>
<span id="cb107-355"><a href="#cb107-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-358"><a href="#cb107-358" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-359"><a href="#cb107-359" aria-hidden="true" tabindex="-1"></a>gbd_long <span class="sc">%&gt;%</span> </span>
<span id="cb107-360"><a href="#cb107-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> deaths_millions)</span>
<span id="cb107-361"><a href="#cb107-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-362"><a href="#cb107-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-363"><a href="#cb107-363" aria-hidden="true" tabindex="-1"></a>This means we can quickly eyeball how the number of deaths has changed from 1990 to 2017 for each cause category and sex. Whereas if we wanted to quickly look at the difference in the number of deaths for females and males, we can change the <span class="in">`names_from =`</span> argument from <span class="in">`= years`</span> to <span class="in">`= sex`</span>. Furthermore, we can also add a <span class="in">`mutate()`</span> to calculate the difference:</span>
<span id="cb107-364"><a href="#cb107-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-367"><a href="#cb107-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-368"><a href="#cb107-368" aria-hidden="true" tabindex="-1"></a>gbd_long <span class="sc">%&gt;%</span> </span>
<span id="cb107-369"><a href="#cb107-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> sex, <span class="at">values_from =</span> deaths_millions) <span class="sc">%&gt;%</span> </span>
<span id="cb107-370"><a href="#cb107-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(Male <span class="sc">-</span> Female)</span>
<span id="cb107-371"><a href="#cb107-371" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-372"><a href="#cb107-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-373"><a href="#cb107-373" aria-hidden="true" tabindex="-1"></a>All of these differences are positive which means every year, more men die than women. Which make sense, as more boys are born than girls.</span>
<span id="cb107-374"><a href="#cb107-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-375"><a href="#cb107-375" aria-hidden="true" tabindex="-1"></a>And what if we want to look at both <span class="in">`year`</span> and <span class="in">`sex`</span> at the same time? No problem, <span class="in">`pivot_wider()`</span> can deal with multiple variables at the same time, <span class="in">`names_from = c(sex, year)`</span>:</span>
<span id="cb107-376"><a href="#cb107-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-379"><a href="#cb107-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-380"><a href="#cb107-380" aria-hidden="true" tabindex="-1"></a>gbd_long <span class="sc">%&gt;%</span> </span>
<span id="cb107-381"><a href="#cb107-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="fu">c</span>(sex, year), <span class="at">values_from =</span> deaths_millions)</span>
<span id="cb107-382"><a href="#cb107-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-383"><a href="#cb107-383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-384"><a href="#cb107-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-385"><a href="#cb107-385" aria-hidden="true" tabindex="-1"></a><span class="in">`pivot_wider()`</span> has a few optional arguments that may be useful for you. For example, <span class="in">`pivot_wider(..., values_fill = 0)`</span> can be used to fill empty cases (if you have any) with a value you specified. Or <span class="in">`pivot_wider(..., names_sep = ": ")`</span> can be used to change the separator that gets put between the values (e.g., you may want "Female: 1990" instead of the default "Female_1990"). Remember that pressing F1 when your cursor is on a function opens it up in the Help tab where these extra options are listed.</span>
<span id="cb107-386"><a href="#cb107-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-387"><a href="#cb107-387" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pivot values from columns to rows (longer)</span></span>
<span id="cb107-388"><a href="#cb107-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-389"><a href="#cb107-389" aria-hidden="true" tabindex="-1"></a>The inverse of <span class="in">`pivot_wider()`</span> is <span class="in">`pivot_longer()`</span>. If you're lucky enough, your data comes from a proper database and is already in the long and tidy format. But if not you'll need to know how to wrangle the variables currently spread across different columns into the tidy format (where each column is a variable, each row is an observation).</span>
<span id="cb107-390"><a href="#cb107-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-391"><a href="#cb107-391" aria-hidden="true" tabindex="-1"></a><span class="in">`pivot_longer()`</span> can be a little bit more difficult to use as you need to describe all the columns to be collected using a <span class="in">`select_helper`</span>. Run <span class="sc">\`</span>?select_helpers and click on the first result in the Help tab for a reminder.</span>
<span id="cb107-392"><a href="#cb107-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-393"><a href="#cb107-393" aria-hidden="true" tabindex="-1"></a>For example, here we want to collect all the columns that include the words Female or Male, the select helper for it is <span class="in">`matches("Female|Male")`</span>:</span>
<span id="cb107-394"><a href="#cb107-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-397"><a href="#cb107-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-398"><a href="#cb107-398" aria-hidden="true" tabindex="-1"></a>gbd_wide <span class="sc">%&gt;%</span> </span>
<span id="cb107-399"><a href="#cb107-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">matches</span>(<span class="st">"Female|Male"</span>), </span>
<span id="cb107-400"><a href="#cb107-400" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"sex_year"</span>, </span>
<span id="cb107-401"><a href="#cb107-401" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"deaths_millions"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb107-402"><a href="#cb107-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb107-403"><a href="#cb107-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-404"><a href="#cb107-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-405"><a href="#cb107-405" aria-hidden="true" tabindex="-1"></a>You're probably looking at the example above and thinking that's all nice and simple on this miniature example dataset, but how on earth will I figure this out on a real-world example. And you're right, we won't deny that <span class="in">`pivot_longer()`</span> is one of the most technically complicated functions in this book, and it can take a lot of trial and error to get it to work. How to get started with your own <span class="in">`pivot_longer()`</span> transformation is to first play with the <span class="in">`select()`</span> function to make sure you are telling R exactly which columns to pivot into the longer format. For example, before working out the <span class="in">`pivot_longer()`</span> code for the above example, we would figure this out first:</span>
<span id="cb107-406"><a href="#cb107-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-409"><a href="#cb107-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-410"><a href="#cb107-410" aria-hidden="true" tabindex="-1"></a>gbd_wide <span class="sc">%&gt;%</span> </span>
<span id="cb107-411"><a href="#cb107-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"Female|Male"</span>))</span>
<span id="cb107-412"><a href="#cb107-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-413"><a href="#cb107-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-414"><a href="#cb107-414" aria-hidden="true" tabindex="-1"></a>Then, knowing that <span class="in">`matches("Female|Male")`</span> works as expected inside our little <span class="in">`select()`</span> test, we can copy-paste it into <span class="in">`pivot_longer()`</span> and add the <span class="in">`names_to`</span> and <span class="in">`values_to`</span> arguments. Both of these arguments are new column names that you can make up (in the above example, we are using "sex_year" and "deaths_millions").</span>
<span id="cb107-415"><a href="#cb107-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-416"><a href="#cb107-416" aria-hidden="true" tabindex="-1"></a><span class="fu">### `separate()` a column into multiple columns</span></span>
<span id="cb107-417"><a href="#cb107-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-418"><a href="#cb107-418" aria-hidden="true" tabindex="-1"></a>While <span class="in">`pivot_longer()`</span> did a great job fetching the different observations that were spread across multiple columns into a single one, it's still a combination of two variables - sex and year. We can use the <span class="in">`separate()`</span> function to deal with that.</span>
<span id="cb107-419"><a href="#cb107-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-422"><a href="#cb107-422" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-423"><a href="#cb107-423" aria-hidden="true" tabindex="-1"></a>gbd_wide <span class="sc">%&gt;%</span> </span>
<span id="cb107-424"><a href="#cb107-424" aria-hidden="true" tabindex="-1"></a>  <span class="co"># same pivot_longer as before</span></span>
<span id="cb107-425"><a href="#cb107-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">matches</span>(<span class="st">"Female|Male"</span>), </span>
<span id="cb107-426"><a href="#cb107-426" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"sex_year"</span>, </span>
<span id="cb107-427"><a href="#cb107-427" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"deaths_millions"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb107-428"><a href="#cb107-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(sex_year, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"sex"</span>, <span class="st">"year"</span>), <span class="at">sep =</span> <span class="st">"_"</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-429"><a href="#cb107-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-430"><a href="#cb107-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-431"><a href="#cb107-431" aria-hidden="true" tabindex="-1"></a>We've also added <span class="in">`convert = TRUE`</span> to <span class="in">`separate()`</span> so <span class="in">`year`</span> would get converted into a numeric variable. The combination of, e.g., "Female-1990" is a character variable, so after separating them both <span class="in">`sex`</span> and <span class="in">`year`</span> would still be classified as characters. But the <span class="in">`convert = TRUE`</span> recognises that <span class="in">`year`</span> is a number and will appropriately convert it into an integer.</span>
<span id="cb107-432"><a href="#cb107-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-433"><a href="#cb107-433" aria-hidden="true" tabindex="-1"></a><span class="fu">## `arrange()` rows</span></span>
<span id="cb107-434"><a href="#cb107-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-435"><a href="#cb107-435" aria-hidden="true" tabindex="-1"></a>The <span class="in">`arrange()`</span> function sorts rows based on the column(s) you want. By default, it arranges the tibble in ascending order:</span>
<span id="cb107-436"><a href="#cb107-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-439"><a href="#cb107-439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-440"><a href="#cb107-440" aria-hidden="true" tabindex="-1"></a>gbd_long <span class="sc">%&gt;%</span> </span>
<span id="cb107-441"><a href="#cb107-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(deaths_millions) <span class="sc">%&gt;%</span> </span>
<span id="cb107-442"><a href="#cb107-442" aria-hidden="true" tabindex="-1"></a>  <span class="co"># first 3 rows just for printing:</span></span>
<span id="cb107-443"><a href="#cb107-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb107-444"><a href="#cb107-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-445"><a href="#cb107-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-446"><a href="#cb107-446" aria-hidden="true" tabindex="-1"></a>For numeric variables, we can just use a <span class="in">`-`</span> to sort in descending order:</span>
<span id="cb107-447"><a href="#cb107-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-450"><a href="#cb107-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-451"><a href="#cb107-451" aria-hidden="true" tabindex="-1"></a>gbd_long <span class="sc">%&gt;%</span> </span>
<span id="cb107-452"><a href="#cb107-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>deaths_millions) <span class="sc">%&gt;%</span> </span>
<span id="cb107-453"><a href="#cb107-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb107-454"><a href="#cb107-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-455"><a href="#cb107-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-456"><a href="#cb107-456" aria-hidden="true" tabindex="-1"></a>The <span class="in">`-`</span> doesn't work for categorical variables; they need to be put in <span class="in">`desc()`</span> for arranging in descending order:</span>
<span id="cb107-457"><a href="#cb107-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-460"><a href="#cb107-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-461"><a href="#cb107-461" aria-hidden="true" tabindex="-1"></a>gbd_long <span class="sc">%&gt;%</span> </span>
<span id="cb107-462"><a href="#cb107-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(sex)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-463"><a href="#cb107-463" aria-hidden="true" tabindex="-1"></a>  <span class="co"># printing rows 1, 2, 11, and 12</span></span>
<span id="cb107-464"><a href="#cb107-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>,<span class="dv">2</span>, <span class="dv">11</span>, <span class="dv">12</span>)</span>
<span id="cb107-465"><a href="#cb107-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-466"><a href="#cb107-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-467"><a href="#cb107-467" aria-hidden="true" tabindex="-1"></a><span class="fu">### Factor levels</span></span>
<span id="cb107-468"><a href="#cb107-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-469"><a href="#cb107-469" aria-hidden="true" tabindex="-1"></a><span class="in">`arrange()`</span> sorts characters alphabetically, whereas factors will be sorted by the order of their levels. Let's make the cause column into a factor:</span>
<span id="cb107-470"><a href="#cb107-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-473"><a href="#cb107-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-474"><a href="#cb107-474" aria-hidden="true" tabindex="-1"></a>gbd_factored <span class="ot">&lt;-</span> gbd_long <span class="sc">%&gt;%</span> </span>
<span id="cb107-475"><a href="#cb107-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cause =</span> <span class="fu">factor</span>(cause))</span>
<span id="cb107-476"><a href="#cb107-476" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-477"><a href="#cb107-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-478"><a href="#cb107-478" aria-hidden="true" tabindex="-1"></a>When we first create a factor, its levels will be ordered alphabetically:</span>
<span id="cb107-479"><a href="#cb107-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-482"><a href="#cb107-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-483"><a href="#cb107-483" aria-hidden="true" tabindex="-1"></a>gbd_factored<span class="sc">$</span>cause <span class="sc">%&gt;%</span> <span class="fu">levels</span>()</span>
<span id="cb107-484"><a href="#cb107-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-485"><a href="#cb107-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-486"><a href="#cb107-486" aria-hidden="true" tabindex="-1"></a>But we can now use <span class="in">`fct_relevel()`</span> inside <span class="in">`mutate()`</span> to change the order of these levels:</span>
<span id="cb107-487"><a href="#cb107-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-490"><a href="#cb107-490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-491"><a href="#cb107-491" aria-hidden="true" tabindex="-1"></a>gbd_factored <span class="ot">&lt;-</span> gbd_factored <span class="sc">%&gt;%</span> </span>
<span id="cb107-492"><a href="#cb107-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cause =</span> cause <span class="sc">%&gt;%</span> </span>
<span id="cb107-493"><a href="#cb107-493" aria-hidden="true" tabindex="-1"></a>           <span class="fu">fct_relevel</span>(<span class="st">"Injuries"</span>))</span>
<span id="cb107-494"><a href="#cb107-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-495"><a href="#cb107-495" aria-hidden="true" tabindex="-1"></a>gbd_factored<span class="sc">$</span>cause <span class="sc">%&gt;%</span> <span class="fu">levels</span>()</span>
<span id="cb107-496"><a href="#cb107-496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-497"><a href="#cb107-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-498"><a href="#cb107-498" aria-hidden="true" tabindex="-1"></a><span class="in">`fct_relevel()`</span> brings the level(s) listed in it to the front.</span>
<span id="cb107-499"><a href="#cb107-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-500"><a href="#cb107-500" aria-hidden="true" tabindex="-1"></a>So if we use <span class="in">`arrange()`</span> on <span class="in">`gbd_factored`</span>, the <span class="in">`cause`</span> column will be sorted based on the order of its levels, not alphabetically. This is especially useful in two places:</span>
<span id="cb107-501"><a href="#cb107-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-502"><a href="#cb107-502" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>plotting - categorical variables that are characters will be ordered alphabetically (e.g., think barplots), regardless of whether the rows are arranged or not;</span>
<span id="cb107-503"><a href="#cb107-503" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>statistical tests - the reference level of categorical variables that are characters is the alphabetically first (e.g., what the odds ratio is relative to).</span>
<span id="cb107-504"><a href="#cb107-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-505"><a href="#cb107-505" aria-hidden="true" tabindex="-1"></a>However, making a character column into a factor gives us power to give its levels a non-alphabetical order, giving us control over plotting order or defining our reference levels for use in statistical tests.</span>
<span id="cb107-506"><a href="#cb107-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-507"><a href="#cb107-507" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb107-508"><a href="#cb107-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-509"><a href="#cb107-509" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise - `pivot_wider()`</span></span>
<span id="cb107-510"><a href="#cb107-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-511"><a href="#cb107-511" aria-hidden="true" tabindex="-1"></a>Using the GBD dataset with variables <span class="in">`cause`</span>, <span class="in">`year`</span> (1990 and 2017 only), <span class="in">`sex`</span> :</span>
<span id="cb107-512"><a href="#cb107-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-513"><a href="#cb107-513" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb107-514"><a href="#cb107-514" aria-hidden="true" tabindex="-1"></a>gbd_long <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"global_burden_disease_cause-year-sex.csv"</span>)  <span class="co">#add your wd</span></span>
<span id="cb107-515"><a href="#cb107-515" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-516"><a href="#cb107-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-517"><a href="#cb107-517" aria-hidden="true" tabindex="-1"></a>Use <span class="in">`pivot_wider()`</span> to put the <span class="in">`cause`</span> variable into columns using the <span class="in">`deaths_millions`</span> as values:</span>
<span id="cb107-518"><a href="#cb107-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-519"><a href="#cb107-519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE}</span></span>
<span id="cb107-520"><a href="#cb107-520" aria-hidden="true" tabindex="-1"></a>gbd_long <span class="sc">%&gt;%</span> </span>
<span id="cb107-521"><a href="#cb107-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> cause, <span class="at">values_from =</span> deaths_millions) </span>
<span id="cb107-522"><a href="#cb107-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-523"><a href="#cb107-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-524"><a href="#cb107-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-525"><a href="#cb107-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-526"><a href="#cb107-526" aria-hidden="true" tabindex="-1"></a>**Solution**</span>
<span id="cb107-527"><a href="#cb107-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-528"><a href="#cb107-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE, results = 'hide'}</span></span>
<span id="cb107-529"><a href="#cb107-529" aria-hidden="true" tabindex="-1"></a>gbd_long <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"global_burden_disease_cause-year-sex.csv"</span>)</span>
<span id="cb107-530"><a href="#cb107-530" aria-hidden="true" tabindex="-1"></a>gbd_long <span class="sc">%&gt;%</span> </span>
<span id="cb107-531"><a href="#cb107-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> cause, <span class="at">values_from =</span> deaths_millions)</span>
<span id="cb107-532"><a href="#cb107-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-533"><a href="#cb107-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-534"><a href="#cb107-534" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise - `group_by()`, `summarise()`</span></span>
<span id="cb107-535"><a href="#cb107-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-536"><a href="#cb107-536" aria-hidden="true" tabindex="-1"></a>Read in the full GBD dataset with variables <span class="in">`cause`</span>, <span class="in">`year`</span>, <span class="in">`sex`</span>, <span class="in">`income`</span>, <span class="in">`deaths_millions`</span>.</span>
<span id="cb107-537"><a href="#cb107-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-538"><a href="#cb107-538" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb107-539"><a href="#cb107-539" aria-hidden="true" tabindex="-1"></a>gbd_full <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"global_burden_disease_cause-year-sex-income.csv"</span>)</span>
<span id="cb107-540"><a href="#cb107-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-541"><a href="#cb107-541" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(gbd_full)</span>
<span id="cb107-542"><a href="#cb107-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-543"><a href="#cb107-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-544"><a href="#cb107-544" aria-hidden="true" tabindex="-1"></a>Year 2017 of this dataset was shown before but we have multiple years avaiable: <span class="in">`r gbd_full$year %&gt;% unique()`</span>.</span>
<span id="cb107-545"><a href="#cb107-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-546"><a href="#cb107-546" aria-hidden="true" tabindex="-1"></a>Investigate these code examples:</span>
<span id="cb107-547"><a href="#cb107-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-550"><a href="#cb107-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-551"><a href="#cb107-551" aria-hidden="true" tabindex="-1"></a>summary_data1 <span class="ot">&lt;-</span> </span>
<span id="cb107-552"><a href="#cb107-552" aria-hidden="true" tabindex="-1"></a>  gbd_full <span class="sc">%&gt;%</span> </span>
<span id="cb107-553"><a href="#cb107-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb107-554"><a href="#cb107-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_per_year =</span> <span class="fu">sum</span>(deaths_millions))</span>
<span id="cb107-555"><a href="#cb107-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-556"><a href="#cb107-556" aria-hidden="true" tabindex="-1"></a>summary_data1</span>
<span id="cb107-557"><a href="#cb107-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-558"><a href="#cb107-558" aria-hidden="true" tabindex="-1"></a>summary_data2 <span class="ot">&lt;-</span> </span>
<span id="cb107-559"><a href="#cb107-559" aria-hidden="true" tabindex="-1"></a>  gbd_full <span class="sc">%&gt;%</span> </span>
<span id="cb107-560"><a href="#cb107-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, cause) <span class="sc">%&gt;%</span> </span>
<span id="cb107-561"><a href="#cb107-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_per_cause =</span> <span class="fu">sum</span>(deaths_millions))</span>
<span id="cb107-562"><a href="#cb107-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-563"><a href="#cb107-563" aria-hidden="true" tabindex="-1"></a>summary_data2</span>
<span id="cb107-564"><a href="#cb107-564" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-565"><a href="#cb107-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-566"><a href="#cb107-566" aria-hidden="true" tabindex="-1"></a>You should recognise that:</span>
<span id="cb107-567"><a href="#cb107-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-568"><a href="#cb107-568" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`summary_data1`</span> includes the total number of deaths per year.</span>
<span id="cb107-569"><a href="#cb107-569" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`summary_data2`</span> includes the number of deaths per cause per year.</span>
<span id="cb107-570"><a href="#cb107-570" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`summary_data1 &lt;-`</span> means we are creating a new dataframe called <span class="in">`summary_data1`</span> and saving (<span class="in">`&lt;-`</span>) results into it. If <span class="in">`summary_data1`</span> was a dataframe that already existed, it would get overwritten.</span>
<span id="cb107-571"><a href="#cb107-571" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`gbd_full`</span> is the data being sent to the <span class="in">`group_by()`</span> and then <span class="in">`summarise()`</span> functions.</span>
<span id="cb107-572"><a href="#cb107-572" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`group_by()`</span> tells <span class="in">`summarise()`</span> that we want aggregated results for each year.</span>
<span id="cb107-573"><a href="#cb107-573" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`summarise()`</span> then creates a new variable called <span class="in">`total_per_year`</span> that sums the deaths from each different observation (subcategory) together.</span>
<span id="cb107-574"><a href="#cb107-574" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calling <span class="in">`summary_data1`</span> on a separate line gets it printed.</span>
<span id="cb107-575"><a href="#cb107-575" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We then do something similar in <span class="in">`summary_data2`</span>.</span>
<span id="cb107-576"><a href="#cb107-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-577"><a href="#cb107-577" aria-hidden="true" tabindex="-1"></a>Compare the number of rows (observations) and number of columns (variables) of <span class="in">`gbd_full`</span>, <span class="in">`summary_data1`</span>, and <span class="in">`summary_data2`</span>.</span>
<span id="cb107-578"><a href="#cb107-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-579"><a href="#cb107-579" aria-hidden="true" tabindex="-1"></a>You should notice that:</span>
<span id="cb107-580"><a href="#cb107-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-581"><a href="#cb107-581" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`summary_data2`</span> has exactly 3 times as many rows (observations) as <span class="in">`summary_data1`</span>. Why?</span>
<span id="cb107-582"><a href="#cb107-582" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`gbd_full`</span> has 5 variables, whereas the summarised tibbles have 2 and 3. Which variables got dropped? How?</span>
<span id="cb107-583"><a href="#cb107-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-584"><a href="#cb107-584" aria-hidden="true" tabindex="-1"></a>**Answers**</span>
<span id="cb107-585"><a href="#cb107-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-586"><a href="#cb107-586" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`gbd_full`</span> has <span class="in">`r nrow(gbd_full)`</span> observations (rows),</span>
<span id="cb107-587"><a href="#cb107-587" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`summary_data1`</span> has <span class="in">`r nrow(summary_data1)`</span>,</span>
<span id="cb107-588"><a href="#cb107-588" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`summary_data2`</span> has <span class="in">`r nrow(summary_data2)`</span>.</span>
<span id="cb107-589"><a href="#cb107-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-590"><a href="#cb107-590" aria-hidden="true" tabindex="-1"></a><span class="in">`summary_data1`</span> was grouped by year, therefore it includes a (summarised) value for each year in the original dataset. <span class="in">`summary_data2`</span> was grouped by year and cause (<span class="in">`r gbd_full$cause %&gt;% unique()`</span>), so it has 3 values for each year.</span>
<span id="cb107-591"><a href="#cb107-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-592"><a href="#cb107-592" aria-hidden="true" tabindex="-1"></a>The columns a <span class="in">`summarise()`</span> function returns are: variables listed in <span class="in">`group_by()`</span> + variables created inside <span class="in">`summarise()`</span> (e.g., in this case <span class="in">`deaths_peryear`</span>). All others get aggregated.</span>
<span id="cb107-593"><a href="#cb107-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-594"><a href="#cb107-594" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise - `full_join()`, `percent()`</span></span>
<span id="cb107-595"><a href="#cb107-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-596"><a href="#cb107-596" aria-hidden="true" tabindex="-1"></a>For each cause, calculate its percentage to total deaths in each year.</span>
<span id="cb107-597"><a href="#cb107-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-598"><a href="#cb107-598" aria-hidden="true" tabindex="-1"></a>Hint: Use <span class="in">`full_join()`</span> on <span class="in">`summary_data1`</span> and <span class="in">`summary_data2`</span>, and then use <span class="in">`mutate()`</span> to add a new column called <span class="in">`percentage`</span>.</span>
<span id="cb107-599"><a href="#cb107-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-600"><a href="#cb107-600" aria-hidden="true" tabindex="-1"></a>Example result for a single year:</span>
<span id="cb107-601"><a href="#cb107-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-602"><a href="#cb107-602" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE}</span></span>
<span id="cb107-603"><a href="#cb107-603" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb107-604"><a href="#cb107-604" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(summary_data1, summary_data2) <span class="sc">%&gt;%</span> </span>
<span id="cb107-605"><a href="#cb107-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> <span class="fu">percent</span>(total_per_cause<span class="sc">/</span>total_per_year)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-606"><a href="#cb107-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1990</span>)</span>
<span id="cb107-607"><a href="#cb107-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-608"><a href="#cb107-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-609"><a href="#cb107-609" aria-hidden="true" tabindex="-1"></a>**Solution**</span>
<span id="cb107-610"><a href="#cb107-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-611"><a href="#cb107-611" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, results='hide'}</span></span>
<span id="cb107-612"><a href="#cb107-612" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb107-613"><a href="#cb107-613" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(summary_data1, summary_data2) <span class="sc">%&gt;%</span> </span>
<span id="cb107-614"><a href="#cb107-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> <span class="fu">percent</span>(total_per_cause<span class="sc">/</span>total_per_year)) </span>
<span id="cb107-615"><a href="#cb107-615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-616"><a href="#cb107-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-617"><a href="#cb107-617" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise - `mutate()`, `summarise()`</span></span>
<span id="cb107-618"><a href="#cb107-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-619"><a href="#cb107-619" aria-hidden="true" tabindex="-1"></a>Instead of creating the two summarised tibbles and using a <span class="in">`full_join()`</span>, achieve the same result as in the previous exercise with a single pipeline using <span class="in">`summarise()`</span> and then <span class="in">`mutate()`</span>.</span>
<span id="cb107-620"><a href="#cb107-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-621"><a href="#cb107-621" aria-hidden="true" tabindex="-1"></a>Hint: you have to do it the other way around, so <span class="in">`group_by(year, cause) %&gt;% summarise(...)`</span> first, then <span class="in">`group_by(year) %&gt;% mutate()`</span>.</span>
<span id="cb107-622"><a href="#cb107-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-623"><a href="#cb107-623" aria-hidden="true" tabindex="-1"></a>Bonus: <span class="in">`select()`</span> columns <span class="in">`year`</span>, <span class="in">`cause`</span>, <span class="in">`percentage`</span>, then <span class="in">`pivot_wider()`</span> the <span class="in">`cause`</span> variable using <span class="in">`percentage`</span> as values.</span>
<span id="cb107-624"><a href="#cb107-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-625"><a href="#cb107-625" aria-hidden="true" tabindex="-1"></a>**Solution**</span>
<span id="cb107-626"><a href="#cb107-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-629"><a href="#cb107-629" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-630"><a href="#cb107-630" aria-hidden="true" tabindex="-1"></a>gbd_full <span class="sc">%&gt;%</span> </span>
<span id="cb107-631"><a href="#cb107-631" aria-hidden="true" tabindex="-1"></a>  <span class="co"># aggregate to deaths per cause per year using summarise()</span></span>
<span id="cb107-632"><a href="#cb107-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, cause) <span class="sc">%&gt;%</span> </span>
<span id="cb107-633"><a href="#cb107-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_per_cause =</span> <span class="fu">sum</span>(deaths_millions)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-634"><a href="#cb107-634" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then add a column of yearly totals using mutate()</span></span>
<span id="cb107-635"><a href="#cb107-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb107-636"><a href="#cb107-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_per_year =</span> <span class="fu">sum</span>(total_per_cause)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-637"><a href="#cb107-637" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the percentage column</span></span>
<span id="cb107-638"><a href="#cb107-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> <span class="fu">percent</span>(total_per_cause<span class="sc">/</span>total_per_year)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-639"><a href="#cb107-639" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select the final variables for better vieweing</span></span>
<span id="cb107-640"><a href="#cb107-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, cause, percentage) <span class="sc">%&gt;%</span> </span>
<span id="cb107-641"><a href="#cb107-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> cause, <span class="at">values_from =</span> percentage)</span>
<span id="cb107-642"><a href="#cb107-642" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-643"><a href="#cb107-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-644"><a href="#cb107-644" aria-hidden="true" tabindex="-1"></a>Note that your pipelines shouldn't be much longer than this, and we often save interim results into separate tibbles for checking (like we did with <span class="in">`summary_data1`</span> and <span class="in">`summary_data2`</span>, making sure the number of rows are what we expect and spot checking that the calculation worked as expected).</span>
<span id="cb107-645"><a href="#cb107-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-646"><a href="#cb107-646" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; R doesn't do what you want it to do, it does what you ask it to do. Testing and spot checking is essential as you will make mistakes. We sure do.</span></span>
<span id="cb107-647"><a href="#cb107-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-648"><a href="#cb107-648" aria-hidden="true" tabindex="-1"></a>Do not feel like you should be able to just bash out these clever pipelines without a lot of trial and error first.</span>
<span id="cb107-649"><a href="#cb107-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-650"><a href="#cb107-650" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise - `filter()`, `summarise()`, `pivot_wider()`</span></span>
<span id="cb107-651"><a href="#cb107-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-652"><a href="#cb107-652" aria-hidden="true" tabindex="-1"></a>Still working with <span class="in">`gbd_full`</span>:</span>
<span id="cb107-653"><a href="#cb107-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-654"><a href="#cb107-654" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Filter for 1990.</span>
<span id="cb107-655"><a href="#cb107-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-656"><a href="#cb107-656" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate the total number of deaths in the different income groups (<span class="in">`r gbd_full$income %&gt;% unique()`</span>). Hint: use <span class="in">`group_by(income)`</span> and <span class="in">`summarise(new_column_name = sum(variable))`</span>.</span>
<span id="cb107-657"><a href="#cb107-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-658"><a href="#cb107-658" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculate the total number of deaths within each income group for males and females. Hint: this is as easy as adding <span class="in">`, sex`</span> to <span class="in">`group_by(income)`</span>.</span>
<span id="cb107-659"><a href="#cb107-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-660"><a href="#cb107-660" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`pivot_wider()`</span> the <span class="in">`income`</span> column.</span>
<span id="cb107-661"><a href="#cb107-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-662"><a href="#cb107-662" aria-hidden="true" tabindex="-1"></a>**Solution**</span>
<span id="cb107-663"><a href="#cb107-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-666"><a href="#cb107-666" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-667"><a href="#cb107-667" aria-hidden="true" tabindex="-1"></a>gbd_full <span class="sc">%&gt;%</span> </span>
<span id="cb107-668"><a href="#cb107-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1990</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb107-669"><a href="#cb107-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(income, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb107-670"><a href="#cb107-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_deaths =</span> <span class="fu">sum</span>(deaths_millions)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-671"><a href="#cb107-671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> income, <span class="at">values_from =</span> total_deaths)</span>
<span id="cb107-672"><a href="#cb107-672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, Laura Bravo</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/laura_bravo94">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/LauBra/RIntro2023">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>